<!DOCTYPE html>
<html lang='ja'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>Coverage: nskk-analytics-optimize.el</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Monaco', 'Courier New', monospace; background: #f5f5f5; }
    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px 30px; }
    .header h1 { font-size: 24px; margin-bottom: 10px; }
    .header .stats { font-size: 14px; opacity: 0.9; }
    .header a { color: white; text-decoration: underline; }
    .container { max-width: 1400px; margin: 20px auto; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; font-family: 'Monaco', 'Courier New', monospace; font-size: 13px; }
    td.line-number { background: #f0f0f0; color: #666; padding: 2px 10px; text-align: right; border-right: 2px solid #ddd; user-select: none; width: 60px; }
    td.line-content { padding: 2px 10px; white-space: pre; }
    tr.covered { background: #e8f5e9; }
    tr.uncovered { background: #ffebee; }
    tr.onevalue { background: #fff3e0; }
    tr.noreturn { background: #f3e5f5; }
    tr:hover { opacity: 0.9; }
    .legend { padding: 15px 30px; background: #fafafa; border-top: 1px solid #e0e0e0; font-size: 12px; }
    .legend-item { display: inline-block; margin-right: 20px; }
    .legend-color { display: inline-block; width: 20px; height: 12px; margin-right: 5px; vertical-align: middle; }
  </style>
</head>
<body>
  <div class='header'>
    <h1>nskk-analytics-optimize.el</h1>
    <div class='stats'>
      Coverage: 65.63% (422/643 forms) •
      <a href='index.html'>← Back to Index</a>
    </div>
  </div>
  <div class='container'>
    <table>
<tr class=''><td class='line-number'>1</td><td class='line-content'>;;; nskk-analytics-optimize.el --- Auto-optimization for NSKK -*- lexical-binding: t; -*-</td></tr>
<tr class=''><td class='line-number'>2</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>3</td><td class='line-content'>;; Copyright (C) 2024 NSKK Development Team</td></tr>
<tr class=''><td class='line-number'>4</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>5</td><td class='line-content'>;; Author: NSKK Development Team</td></tr>
<tr class=''><td class='line-number'>6</td><td class='line-content'>;; Keywords: japanese, input method, skk, analytics, optimization</td></tr>
<tr class=''><td class='line-number'>7</td><td class='line-content'>;; Version: 1.0.0</td></tr>
<tr class=''><td class='line-number'>8</td><td class='line-content'>;; Package-Requires: ((emacs &amp;quot;31.0&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>9</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>10</td><td class='line-content'>;; This file is part of NSKK.</td></tr>
<tr class=''><td class='line-number'>11</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>12</td><td class='line-content'>;; NSKK is free software: you can redistribute it and/or modify</td></tr>
<tr class=''><td class='line-number'>13</td><td class='line-content'>;; it under the terms of the GNU General Public License as published by</td></tr>
<tr class=''><td class='line-number'>14</td><td class='line-content'>;; the Free Software Foundation, either version 3 of the License, or</td></tr>
<tr class=''><td class='line-number'>15</td><td class='line-content'>;; (at your option) any later version.</td></tr>
<tr class=''><td class='line-number'>16</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>17</td><td class='line-content'>;; NSKK is distributed in the hope that it will be useful,</td></tr>
<tr class=''><td class='line-number'>18</td><td class='line-content'>;; but WITHOUT ANY WARRANTY; without even the implied warranty of</td></tr>
<tr class=''><td class='line-number'>19</td><td class='line-content'>;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td></tr>
<tr class=''><td class='line-number'>20</td><td class='line-content'>;; GNU General Public License for more details.</td></tr>
<tr class=''><td class='line-number'>21</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>22</td><td class='line-content'>;; You should have received a copy of the GNU General Public License</td></tr>
<tr class=''><td class='line-number'>23</td><td class='line-content'>;; along with NSKK.  If not, see &amp;lt;https://www.gnu.org/licenses/&amp;gt;.</td></tr>
<tr class=''><td class='line-number'>24</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>25</td><td class='line-content'>;;; Commentary:</td></tr>
<tr class=''><td class='line-number'>26</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>27</td><td class='line-content'>;; このファイルはNSKKの自動最適化システムを提供します。</td></tr>
<tr class=''><td class='line-number'>28</td><td class='line-content'>;;</td></tr>
<tr class=''><td class='line-number'>29</td><td class='line-content'>;; 主な機能:</td></tr>
<tr class=''><td class='line-number'>30</td><td class='line-content'>;; 1. パラメータ自動調整 - キャッシュサイズ、スレッド数等を自動調整</td></tr>
<tr class=''><td class='line-number'>31</td><td class='line-content'>;; 2. A/Bテスト - 複数の設定を比較し最適な設定を特定</td></tr>
<tr class=''><td class='line-number'>32</td><td class='line-content'>;; 3. 最適化提案 - 使用パターンに基づいた改善提案</td></tr>
<tr class=''><td class='line-number'>33</td><td class='line-content'>;; 4. 自動適用 - 最適化を自動で適用（オプション）</td></tr>
<tr class=''><td class='line-number'>34</td><td class='line-content'>;;</td></tr>
<tr class=''><td class='line-number'>35</td><td class='line-content'>;; 使用例:</td></tr>
<tr class=''><td class='line-number'>36</td><td class='line-content'>;; (require 'nskk-analytics-optimize)</td></tr>
<tr class=''><td class='line-number'>37</td><td class='line-content'>;;</td></tr>
<tr class=''><td class='line-number'>38</td><td class='line-content'>;; ;; A/Bテスト実行</td></tr>
<tr class=''><td class='line-number'>39</td><td class='line-content'>;; (nskk-analytics-run-ab-test &amp;quot;cache-size&amp;quot;</td></tr>
<tr class=''><td class='line-number'>40</td><td class='line-content'>;;                             '((nskk-cache-size . 1000))</td></tr>
<tr class=''><td class='line-number'>41</td><td class='line-content'>;;                             '((nskk-cache-size . 5000)))</td></tr>
<tr class=''><td class='line-number'>42</td><td class='line-content'>;;</td></tr>
<tr class=''><td class='line-number'>43</td><td class='line-content'>;; ;; 最適化提案取得</td></tr>
<tr class=''><td class='line-number'>44</td><td class='line-content'>;; (nskk-analytics-suggest-optimizations)</td></tr>
<tr class=''><td class='line-number'>45</td><td class='line-content'>;;</td></tr>
<tr class=''><td class='line-number'>46</td><td class='line-content'>;; ;; 自動最適化実行</td></tr>
<tr class=''><td class='line-number'>47</td><td class='line-content'>;; (nskk-analytics-auto-optimize)</td></tr>
<tr class=''><td class='line-number'>48</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>49</td><td class='line-content'>;;; Code:</td></tr>
<tr class=''><td class='line-number'>50</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>51</td><td class='line-content'>(require 'cl-lib)</td></tr>
<tr class=''><td class='line-number'>52</td><td class='line-content'>(require 'nskk-analytics-pattern)</td></tr>
<tr class=''><td class='line-number'>53</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>54</td><td class='line-content'>;;; カスタマイズ変数</td></tr>
<tr class=''><td class='line-number'>55</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>56</td><td class='line-content'>(defgroup nskk-analytics-optimize nil</td></tr>
<tr class=''><td class='line-number'>57</td><td class='line-content'>  &amp;quot;NSKK auto-optimization settings.&amp;quot;</td></tr>
<tr class=''><td class='line-number'>58</td><td class='line-content'>  :group 'nskk</td></tr>
<tr class=''><td class='line-number'>59</td><td class='line-content'>  :prefix &amp;quot;nskk-analytics-optimize-&amp;quot;)</td></tr>
<tr class=''><td class='line-number'>60</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>61</td><td class='line-content'>(defcustom nskk-analytics-optimize-auto-apply nil</td></tr>
<tr class=''><td class='line-number'>62</td><td class='line-content'>  &amp;quot;非nilの場合、最適化を自動で適用する。&amp;quot;</td></tr>
<tr class=''><td class='line-number'>63</td><td class='line-content'>  :type 'boolean</td></tr>
<tr class=''><td class='line-number'>64</td><td class='line-content'>  :group 'nskk-analytics-optimize)</td></tr>
<tr class=''><td class='line-number'>65</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>66</td><td class='line-content'>(defcustom nskk-analytics-optimize-min-samples 100</td></tr>
<tr class=''><td class='line-number'>67</td><td class='line-content'>  &amp;quot;最適化判定に必要な最小サンプル数。&amp;quot;</td></tr>
<tr class=''><td class='line-number'>68</td><td class='line-content'>  :type 'integer</td></tr>
<tr class=''><td class='line-number'>69</td><td class='line-content'>  :group 'nskk-analytics-optimize)</td></tr>
<tr class=''><td class='line-number'>70</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>71</td><td class='line-content'>(defcustom nskk-analytics-optimize-confidence-level 0.95</td></tr>
<tr class=''><td class='line-number'>72</td><td class='line-content'>  &amp;quot;統計的有意性の信頼水準（0.0-1.0）。&amp;quot;</td></tr>
<tr class=''><td class='line-number'>73</td><td class='line-content'>  :type 'float</td></tr>
<tr class=''><td class='line-number'>74</td><td class='line-content'>  :group 'nskk-analytics-optimize)</td></tr>
<tr class=''><td class='line-number'>75</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>76</td><td class='line-content'>;;; データ構造</td></tr>
<tr class=''><td class='line-number'>77</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>78</td><td class='line-content'>(cl-defstruct (nskk-analytics-ab-test</td></tr>
<tr class=''><td class='line-number'>79</td><td class='line-content'>               (:constructor nskk-analytics-ab-test-create)</td></tr>
<tr class=''><td class='line-number'>80</td><td class='line-content'>               (:copier nskk-analytics-ab-test-copy))</td></tr>
<tr class=''><td class='line-number'>81</td><td class='line-content'>  &amp;quot;A/Bテスト構造体。</td></tr>
<tr class=''><td class='line-number'>82</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>83</td><td class='line-content'>スロット:</td></tr>
<tr class=''><td class='line-number'>84</td><td class='line-content'>  name         - テスト名</td></tr>
<tr class=''><td class='line-number'>85</td><td class='line-content'>  variant-a    - 設定A（alist）</td></tr>
<tr class=''><td class='line-number'>86</td><td class='line-content'>  variant-b    - 設定B（alist）</td></tr>
<tr class=''><td class='line-number'>87</td><td class='line-content'>  metrics      - 追跡するメトリクス（シンボルのリスト）</td></tr>
<tr class=''><td class='line-number'>88</td><td class='line-content'>  duration     - テスト期間（秒）</td></tr>
<tr class=''><td class='line-number'>89</td><td class='line-content'>  results      - テスト結果（plist）</td></tr>
<tr class=''><td class='line-number'>90</td><td class='line-content'>  start-time   - 開始時刻</td></tr>
<tr class=''><td class='line-number'>91</td><td class='line-content'>  active       - アクティブフラグ&amp;quot;</td></tr>
<tr class=''><td class='line-number'>92</td><td class='line-content'>  (name nil)</td></tr>
<tr class=''><td class='line-number'>93</td><td class='line-content'>  (variant-a nil)</td></tr>
<tr class=''><td class='line-number'>94</td><td class='line-content'>  (variant-b nil)</td></tr>
<tr class=''><td class='line-number'>95</td><td class='line-content'>  (metrics '(speed accuracy conversions))</td></tr>
<tr class=''><td class='line-number'>96</td><td class='line-content'>  (duration 3600)</td></tr>
<tr class=''><td class='line-number'>97</td><td class='line-content'>  (results nil)</td></tr>
<tr class=''><td class='line-number'>98</td><td class='line-content'>  (start-time nil)</td></tr>
<tr class=''><td class='line-number'>99</td><td class='line-content'>  (active nil))</td></tr>
<tr class=''><td class='line-number'>100</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>101</td><td class='line-content'>(cl-defstruct (nskk-analytics-optimization</td></tr>
<tr class=''><td class='line-number'>102</td><td class='line-content'>               (:constructor nskk-analytics-optimization-create)</td></tr>
<tr class=''><td class='line-number'>103</td><td class='line-content'>               (:copier nskk-analytics-optimization-copy))</td></tr>
<tr class=''><td class='line-number'>104</td><td class='line-content'>  &amp;quot;最適化提案構造体。</td></tr>
<tr class=''><td class='line-number'>105</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>106</td><td class='line-content'>スロット:</td></tr>
<tr class=''><td class='line-number'>107</td><td class='line-content'>  parameter    - パラメータ名</td></tr>
<tr class=''><td class='line-number'>108</td><td class='line-content'>  current      - 現在の値</td></tr>
<tr class=''><td class='line-number'>109</td><td class='line-content'>  suggested    - 提案値</td></tr>
<tr class=''><td class='line-number'>110</td><td class='line-content'>  reason       - 提案理由</td></tr>
<tr class=''><td class='line-number'>111</td><td class='line-content'>  impact       - 予想される効果（high/medium/low）</td></tr>
<tr class=''><td class='line-number'>112</td><td class='line-content'>  confidence   - 信頼度（0.0-1.0）&amp;quot;</td></tr>
<tr class=''><td class='line-number'>113</td><td class='line-content'>  (parameter nil)</td></tr>
<tr class=''><td class='line-number'>114</td><td class='line-content'>  (current nil)</td></tr>
<tr class=''><td class='line-number'>115</td><td class='line-content'>  (suggested nil)</td></tr>
<tr class=''><td class='line-number'>116</td><td class='line-content'>  (reason nil)</td></tr>
<tr class=''><td class='line-number'>117</td><td class='line-content'>  (impact 'medium)</td></tr>
<tr class=''><td class='line-number'>118</td><td class='line-content'>  (confidence 0.5))</td></tr>
<tr class=''><td class='line-number'>119</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>120</td><td class='line-content'>;;; 内部変数</td></tr>
<tr class=''><td class='line-number'>121</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>122</td><td class='line-content'>(defvar nskk-analytics-optimize--tests nil</td></tr>
<tr class=''><td class='line-number'>123</td><td class='line-content'>  &amp;quot;実行中/完了したA/Bテストのリスト。&amp;quot;)</td></tr>
<tr class=''><td class='line-number'>124</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>125</td><td class='line-content'>(defvar nskk-analytics-optimize--optimizations nil</td></tr>
<tr class=''><td class='line-number'>126</td><td class='line-content'>  &amp;quot;最適化提案のリスト。&amp;quot;)</td></tr>
<tr class=''><td class='line-number'>127</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>128</td><td class='line-content'>(defvar nskk-analytics-optimize--parameters</td></tr>
<tr class=''><td class='line-number'>129</td><td class='line-content'>  '((nskk-cache-size . (100 10000))</td></tr>
<tr class=''><td class='line-number'>130</td><td class='line-content'>    (nskk-thread-pool-size . (2 16))</td></tr>
<tr class=''><td class='line-number'>131</td><td class='line-content'>    (nskk-completion-limit . (10 100))</td></tr>
<tr class=''><td class='line-number'>132</td><td class='line-content'>    (nskk-history-size . (100 10000)))</td></tr>
<tr class=''><td class='line-number'>133</td><td class='line-content'>  &amp;quot;最適化可能なパラメータとその範囲。&amp;quot;)</td></tr>
<tr class=''><td class='line-number'>134</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>135</td><td class='line-content'>;;; A/Bテスト</td></tr>
<tr class=''><td class='line-number'>136</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>137</td><td class='line-content'>;;;###autoload</td></tr>
<tr class=''><td class='line-number'>138</td><td class='line-content'>(defun nskk-analytics-run-ab-test (name variant-a variant-b &amp;optional duration)</td></tr>
<tr class=''><td class='line-number'>139</td><td class='line-content'>  &amp;quot;A/Bテストを実行する。</td></tr>
<tr class=''><td class='line-number'>140</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>141</td><td class='line-content'>NAME: テスト名</td></tr>
<tr class=''><td class='line-number'>142</td><td class='line-content'>VARIANT-A: 設定A（alist）</td></tr>
<tr class=''><td class='line-number'>143</td><td class='line-content'>VARIANT-B: 設定B（alist）</td></tr>
<tr class=''><td class='line-number'>144</td><td class='line-content'>DURATION: テスト期間（秒、デフォルト: 3600）&amp;quot;</td></tr>
<tr class=''><td class='line-number'>145</td><td class='line-content'>  (interactive</td></tr>
<tr class='covered'><td class='line-number'>146</td><td class='line-content'>   (list (read-string &amp;quot;Test name: &amp;quot;)</td></tr>
<tr class='covered'><td class='line-number'>147</td><td class='line-content'>         (read--expression &amp;quot;Variant A (alist): &amp;quot;)</td></tr>
<tr class='covered'><td class='line-number'>148</td><td class='line-content'>         (read--expression &amp;quot;Variant B (alist): &amp;quot;)</td></tr>
<tr class='covered'><td class='line-number'>149</td><td class='line-content'>         (read-number &amp;quot;Duration (seconds): &amp;quot; 3600)))</td></tr>
<tr class=''><td class='line-number'>150</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>151</td><td class='line-content'>  (let ((test (nskk-analytics-ab-test-create</td></tr>
<tr class='uncovered'><td class='line-number'>152</td><td class='line-content'>               :name name</td></tr>
<tr class='uncovered'><td class='line-number'>153</td><td class='line-content'>               :variant-a variant-a</td></tr>
<tr class='uncovered'><td class='line-number'>154</td><td class='line-content'>               :variant-b variant-b</td></tr>
<tr class='covered'><td class='line-number'>155</td><td class='line-content'>               :duration (or duration 3600)</td></tr>
<tr class='covered'><td class='line-number'>156</td><td class='line-content'>               :start-time (current-time)</td></tr>
<tr class='uncovered'><td class='line-number'>157</td><td class='line-content'>               :active t)))</td></tr>
<tr class=''><td class='line-number'>158</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>159</td><td class='line-content'>    ;; テストリストに追加</td></tr>
<tr class='covered'><td class='line-number'>160</td><td class='line-content'>    (push test nskk-analytics-optimize--tests)</td></tr>
<tr class=''><td class='line-number'>161</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>162</td><td class='line-content'>    ;; Variant A を適用</td></tr>
<tr class='covered'><td class='line-number'>163</td><td class='line-content'>    (nskk-analytics-optimize--apply-variant variant-a)</td></tr>
<tr class=''><td class='line-number'>164</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>165</td><td class='line-content'>    ;; タイマーで Variant B に切り替え</td></tr>
<tr class='covered'><td class='line-number'>166</td><td class='line-content'>    (run-at-time (/ (or duration 3600) 2.0) nil</td></tr>
<tr class=''><td class='line-number'>167</td><td class='line-content'>                 (lambda ()</td></tr>
<tr class='covered'><td class='line-number'>168</td><td class='line-content'>                   (nskk-analytics-optimize--apply-variant variant-b)))</td></tr>
<tr class=''><td class='line-number'>169</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>170</td><td class='line-content'>    ;; タイマーでテスト終了</td></tr>
<tr class='covered'><td class='line-number'>171</td><td class='line-content'>    (run-at-time (or duration 3600) nil</td></tr>
<tr class=''><td class='line-number'>172</td><td class='line-content'>                 (lambda ()</td></tr>
<tr class='covered'><td class='line-number'>173</td><td class='line-content'>                   (nskk-analytics-optimize--complete-ab-test test)))</td></tr>
<tr class=''><td class='line-number'>174</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>175</td><td class='line-content'>    (message &amp;quot;A/B test '%s' started (duration: %d seconds)&amp;quot; name (or duration 3600))</td></tr>
<tr class='uncovered'><td class='line-number'>176</td><td class='line-content'>    test))</td></tr>
<tr class=''><td class='line-number'>177</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>178</td><td class='line-content'>(defun nskk-analytics-optimize--apply-variant (variant)</td></tr>
<tr class=''><td class='line-number'>179</td><td class='line-content'>  &amp;quot;設定バリアントを適用する。</td></tr>
<tr class=''><td class='line-number'>180</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>181</td><td class='line-content'>VARIANT: 設定のalist&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>182</td><td class='line-content'>  (dolist (setting variant)</td></tr>
<tr class='onevalue'><td class='line-number'>183</td><td class='line-content'>    (set (car setting) (cdr setting))))</td></tr>
<tr class=''><td class='line-number'>184</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>185</td><td class='line-content'>(defun nskk-analytics-optimize--complete-ab-test (test)</td></tr>
<tr class=''><td class='line-number'>186</td><td class='line-content'>  &amp;quot;A/Bテストを完了する。</td></tr>
<tr class=''><td class='line-number'>187</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>188</td><td class='line-content'>TEST: A/Bテスト構造体&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>189</td><td class='line-content'>  (setf (nskk-analytics-ab-test-active test) nil)</td></tr>
<tr class=''><td class='line-number'>190</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>191</td><td class='line-content'>  ;; 結果を分析</td></tr>
<tr class='covered'><td class='line-number'>192</td><td class='line-content'>  (let* ((metrics (nskk-analytics-collect-metrics))</td></tr>
<tr class='covered'><td class='line-number'>193</td><td class='line-content'>         (results (nskk-analytics-optimize--analyze-ab-results test metrics)))</td></tr>
<tr class='covered'><td class='line-number'>194</td><td class='line-content'>    (setf (nskk-analytics-ab-test-results test) results)</td></tr>
<tr class=''><td class='line-number'>195</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>196</td><td class='line-content'>    (message &amp;quot;A/B test '%s' completed. Winner: %s&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>197</td><td class='line-content'>             (nskk-analytics-ab-test-name test)</td></tr>
<tr class='covered'><td class='line-number'>198</td><td class='line-content'>             (plist-get results :winner))))</td></tr>
<tr class=''><td class='line-number'>199</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>200</td><td class='line-content'>(defun nskk-analytics-optimize--analyze-ab-results (test metrics)</td></tr>
<tr class=''><td class='line-number'>201</td><td class='line-content'>  &amp;quot;A/Bテスト結果を分析する。</td></tr>
<tr class=''><td class='line-number'>202</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>203</td><td class='line-content'>TEST: A/Bテスト構造体</td></tr>
<tr class=''><td class='line-number'>204</td><td class='line-content'>METRICS: メトリクス構造体</td></tr>
<tr class=''><td class='line-number'>205</td><td class='line-content'>戻り値: 結果のplist&amp;quot;</td></tr>
<tr class=''><td class='line-number'>206</td><td class='line-content'>  ;; 簡易的な実装（実際にはより詳細な統計分析が必要）</td></tr>
<tr class='covered'><td class='line-number'>207</td><td class='line-content'>  (let* ((speed (nskk-analytics-metrics-speed metrics))</td></tr>
<tr class='covered'><td class='line-number'>208</td><td class='line-content'>         (accuracy (nskk-analytics-metrics-accuracy metrics))</td></tr>
<tr class='covered'><td class='line-number'>209</td><td class='line-content'>         (score (+ (* speed 0.6) (* accuracy 0.4)))</td></tr>
<tr class='covered'><td class='line-number'>210</td><td class='line-content'>         (winner (if (&amp;gt; score 0.5) 'variant-b 'variant-a))</td></tr>
<tr class='covered'><td class='line-number'>211</td><td class='line-content'>         (significance (nskk-analytics-ab-significance</td></tr>
<tr class='covered'><td class='line-number'>212</td><td class='line-content'>                        `((speed . ,speed) (accuracy . ,accuracy))</td></tr>
<tr class='covered'><td class='line-number'>213</td><td class='line-content'>                        `((speed . ,(+ speed 0.01)) (accuracy . ,(- accuracy 0.01))))))</td></tr>
<tr class='covered'><td class='line-number'>214</td><td class='line-content'>    `(:winner ,winner</td></tr>
<tr class='uncovered'><td class='line-number'>215</td><td class='line-content'>      :score ,score</td></tr>
<tr class='uncovered'><td class='line-number'>216</td><td class='line-content'>      :significance ,significance</td></tr>
<tr class='uncovered'><td class='line-number'>217</td><td class='line-content'>      :metrics ,metrics)))</td></tr>
<tr class=''><td class='line-number'>218</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>219</td><td class='line-content'>;;;###autoload</td></tr>
<tr class=''><td class='line-number'>220</td><td class='line-content'>(defun nskk-analytics-ab-significance (results-a results-b)</td></tr>
<tr class=''><td class='line-number'>221</td><td class='line-content'>  &amp;quot;2つの結果の統計的有意性を計算する。</td></tr>
<tr class=''><td class='line-number'>222</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>223</td><td class='line-content'>RESULTS-A: 結果A（alist）</td></tr>
<tr class=''><td class='line-number'>224</td><td class='line-content'>RESULTS-B: 結果B（alist）</td></tr>
<tr class=''><td class='line-number'>225</td><td class='line-content'>戻り値: 有意性（t/nil）&amp;quot;</td></tr>
<tr class=''><td class='line-number'>226</td><td class='line-content'>  ;; t検定の簡易実装（実際には標本サイズと分散も考慮）</td></tr>
<tr class='covered'><td class='line-number'>227</td><td class='line-content'>  (let ((diff-speed (abs (- (alist-get 'speed results-a)</td></tr>
<tr class='covered'><td class='line-number'>228</td><td class='line-content'>                            (alist-get 'speed results-b))))</td></tr>
<tr class='covered'><td class='line-number'>229</td><td class='line-content'>        (diff-accuracy (abs (- (alist-get 'accuracy results-a)</td></tr>
<tr class='covered'><td class='line-number'>230</td><td class='line-content'>                               (alist-get 'accuracy results-b)))))</td></tr>
<tr class=''><td class='line-number'>231</td><td class='line-content'>    ;; 差が十分大きい場合に有意とみなす</td></tr>
<tr class='covered'><td class='line-number'>232</td><td class='line-content'>    (or (&amp;gt; diff-speed 0.05)</td></tr>
<tr class='covered'><td class='line-number'>233</td><td class='line-content'>        (&amp;gt; diff-accuracy 0.1))))</td></tr>
<tr class=''><td class='line-number'>234</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>235</td><td class='line-content'>;;; 自動最適化</td></tr>
<tr class=''><td class='line-number'>236</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>237</td><td class='line-content'>;;;###autoload</td></tr>
<tr class=''><td class='line-number'>238</td><td class='line-content'>(defun nskk-analytics-suggest-optimizations ()</td></tr>
<tr class=''><td class='line-number'>239</td><td class='line-content'>  &amp;quot;使用パターンに基づいた最適化を提案する。</td></tr>
<tr class=''><td class='line-number'>240</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>241</td><td class='line-content'>戻り値: 最適化提案のリスト&amp;quot;</td></tr>
<tr class=''><td class='line-number'>242</td><td class='line-content'>  (interactive)</td></tr>
<tr class='covered'><td class='line-number'>243</td><td class='line-content'>  (let ((metrics (nskk-analytics-collect-metrics))</td></tr>
<tr class='covered'><td class='line-number'>244</td><td class='line-content'>        (patterns (nskk-analytics-detect-patterns))</td></tr>
<tr class=''><td class='line-number'>245</td><td class='line-content'>        (suggestions nil))</td></tr>
<tr class=''><td class='line-number'>246</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>247</td><td class='line-content'>    ;; キャッシュサイズの最適化</td></tr>
<tr class='covered'><td class='line-number'>248</td><td class='line-content'>    (let ((cache-opt (nskk-analytics-optimize--suggest-cache-size metrics patterns)))</td></tr>
<tr class='covered'><td class='line-number'>249</td><td class='line-content'>      (when cache-opt</td></tr>
<tr class='covered'><td class='line-number'>250</td><td class='line-content'>        (push cache-opt suggestions)))</td></tr>
<tr class=''><td class='line-number'>251</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>252</td><td class='line-content'>    ;; スレッドプールサイズの最適化</td></tr>
<tr class='covered'><td class='line-number'>253</td><td class='line-content'>    (let ((thread-opt (nskk-analytics-optimize--suggest-thread-pool-size patterns)))</td></tr>
<tr class='covered'><td class='line-number'>254</td><td class='line-content'>      (when thread-opt</td></tr>
<tr class='covered'><td class='line-number'>255</td><td class='line-content'>        (push thread-opt suggestions)))</td></tr>
<tr class=''><td class='line-number'>256</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>257</td><td class='line-content'>    ;; 補完制限の最適化</td></tr>
<tr class='covered'><td class='line-number'>258</td><td class='line-content'>    (let ((completion-opt (nskk-analytics-optimize--suggest-completion-limit metrics)))</td></tr>
<tr class='covered'><td class='line-number'>259</td><td class='line-content'>      (when completion-opt</td></tr>
<tr class='covered'><td class='line-number'>260</td><td class='line-content'>        (push completion-opt suggestions)))</td></tr>
<tr class=''><td class='line-number'>261</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>262</td><td class='line-content'>    ;; 履歴サイズの最適化</td></tr>
<tr class='covered'><td class='line-number'>263</td><td class='line-content'>    (let ((history-opt (nskk-analytics-optimize--suggest-history-size patterns)))</td></tr>
<tr class='covered'><td class='line-number'>264</td><td class='line-content'>      (when history-opt</td></tr>
<tr class='covered'><td class='line-number'>265</td><td class='line-content'>        (push history-opt suggestions)))</td></tr>
<tr class=''><td class='line-number'>266</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>267</td><td class='line-content'>    (setq nskk-analytics-optimize--optimizations (nreverse suggestions))</td></tr>
<tr class=''><td class='line-number'>268</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>269</td><td class='line-content'>    (when (called-interactively-p 'interactive)</td></tr>
<tr class='covered'><td class='line-number'>270</td><td class='line-content'>      (nskk-analytics-optimize--display-suggestions suggestions))</td></tr>
<tr class=''><td class='line-number'>271</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>272</td><td class='line-content'>    suggestions))</td></tr>
<tr class=''><td class='line-number'>273</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>274</td><td class='line-content'>(defun nskk-analytics-optimize--suggest-cache-size (metrics patterns)</td></tr>
<tr class=''><td class='line-number'>275</td><td class='line-content'>  &amp;quot;キャッシュサイズの最適化を提案する。</td></tr>
<tr class=''><td class='line-number'>276</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>277</td><td class='line-content'>METRICS: メトリクス構造体</td></tr>
<tr class=''><td class='line-number'>278</td><td class='line-content'>PATTERNS: パターンのalist</td></tr>
<tr class=''><td class='line-number'>279</td><td class='line-content'>戻り値: 最適化提案またはnil&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>280</td><td class='line-content'>  (let* ((conversions (nskk-analytics-metrics-conversions metrics))</td></tr>
<tr class='covered'><td class='line-number'>281</td><td class='line-content'>         (current-size (or (bound-and-true-p nskk-cache-size) 1000))</td></tr>
<tr class='covered'><td class='line-number'>282</td><td class='line-content'>         (suggested-size (min 10000 (* conversions 2))))</td></tr>
<tr class=''><td class='line-number'>283</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>284</td><td class='line-content'>    (when (and (&amp;gt; conversions 100)</td></tr>
<tr class='covered'><td class='line-number'>285</td><td class='line-content'>               (&amp;gt; (abs (- suggested-size current-size)) 500))</td></tr>
<tr class='covered'><td class='line-number'>286</td><td class='line-content'>      (nskk-analytics-optimization-create</td></tr>
<tr class=''><td class='line-number'>287</td><td class='line-content'>       :parameter 'nskk-cache-size</td></tr>
<tr class='covered'><td class='line-number'>288</td><td class='line-content'>       :current current-size</td></tr>
<tr class='covered'><td class='line-number'>289</td><td class='line-content'>       :suggested suggested-size</td></tr>
<tr class='covered'><td class='line-number'>290</td><td class='line-content'>       :reason (format &amp;quot;Based on %d conversions, larger cache may improve performance&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>291</td><td class='line-content'>                       conversions)</td></tr>
<tr class='covered'><td class='line-number'>292</td><td class='line-content'>       :impact (if (&amp;gt; (- suggested-size current-size) 2000) 'high 'medium)</td></tr>
<tr class='covered'><td class='line-number'>293</td><td class='line-content'>       :confidence 0.8))))</td></tr>
<tr class=''><td class='line-number'>294</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>295</td><td class='line-content'>(defun nskk-analytics-optimize--suggest-thread-pool-size (patterns)</td></tr>
<tr class=''><td class='line-number'>296</td><td class='line-content'>  &amp;quot;スレッドプールサイズの最適化を提案する。</td></tr>
<tr class=''><td class='line-number'>297</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>298</td><td class='line-content'>PATTERNS: パターンのalist</td></tr>
<tr class=''><td class='line-number'>299</td><td class='line-content'>戻り値: 最適化提案またはnil&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>300</td><td class='line-content'>  (let* ((intensity (alist-get 'usage-intensity patterns))</td></tr>
<tr class='covered'><td class='line-number'>301</td><td class='line-content'>         (current-size (or (bound-and-true-p nskk-thread-pool-size) 4))</td></tr>
<tr class='covered'><td class='line-number'>302</td><td class='line-content'>         (suggested-size (cond</td></tr>
<tr class='covered'><td class='line-number'>303</td><td class='line-content'>                          ((&amp;gt; intensity 1000) 8)</td></tr>
<tr class='covered'><td class='line-number'>304</td><td class='line-content'>                          ((&amp;gt; intensity 500) 6)</td></tr>
<tr class='covered'><td class='line-number'>305</td><td class='line-content'>                          ((&amp;gt; intensity 100) 4)</td></tr>
<tr class='covered'><td class='line-number'>306</td><td class='line-content'>                          (t 2))))</td></tr>
<tr class=''><td class='line-number'>307</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>308</td><td class='line-content'>    (when (not (eq suggested-size current-size))</td></tr>
<tr class='covered'><td class='line-number'>309</td><td class='line-content'>      (nskk-analytics-optimization-create</td></tr>
<tr class=''><td class='line-number'>310</td><td class='line-content'>       :parameter 'nskk-thread-pool-size</td></tr>
<tr class='covered'><td class='line-number'>311</td><td class='line-content'>       :current current-size</td></tr>
<tr class='covered'><td class='line-number'>312</td><td class='line-content'>       :suggested suggested-size</td></tr>
<tr class='covered'><td class='line-number'>313</td><td class='line-content'>       :reason (format &amp;quot;Based on usage intensity (%.0f events/day)&amp;quot; intensity)</td></tr>
<tr class=''><td class='line-number'>314</td><td class='line-content'>       :impact 'medium</td></tr>
<tr class='covered'><td class='line-number'>315</td><td class='line-content'>       :confidence 0.7))))</td></tr>
<tr class=''><td class='line-number'>316</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>317</td><td class='line-content'>(defun nskk-analytics-optimize--suggest-completion-limit (metrics)</td></tr>
<tr class=''><td class='line-number'>318</td><td class='line-content'>  &amp;quot;補完制限の最適化を提案する。</td></tr>
<tr class=''><td class='line-number'>319</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>320</td><td class='line-content'>METRICS: メトリクス構造体</td></tr>
<tr class=''><td class='line-number'>321</td><td class='line-content'>戻り値: 最適化提案またはnil&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>322</td><td class='line-content'>  (let* ((speed (nskk-analytics-metrics-speed metrics))</td></tr>
<tr class='covered'><td class='line-number'>323</td><td class='line-content'>         (current-limit (or (bound-and-true-p nskk-completion-limit) 20))</td></tr>
<tr class='covered'><td class='line-number'>324</td><td class='line-content'>         (suggested-limit (cond</td></tr>
<tr class='covered'><td class='line-number'>325</td><td class='line-content'>                           ((&amp;lt; speed 0.05) 50)   ;; 速い場合は多めに</td></tr>
<tr class='covered'><td class='line-number'>326</td><td class='line-content'>                           ((&amp;lt; speed 0.1) 30)</td></tr>
<tr class='covered'><td class='line-number'>327</td><td class='line-content'>                           ((&amp;lt; speed 0.2) 20)</td></tr>
<tr class='covered'><td class='line-number'>328</td><td class='line-content'>                           (t 10))))             ;; 遅い場合は少なめに</td></tr>
<tr class=''><td class='line-number'>329</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>330</td><td class='line-content'>    (when (not (eq suggested-limit current-limit))</td></tr>
<tr class='covered'><td class='line-number'>331</td><td class='line-content'>      (nskk-analytics-optimization-create</td></tr>
<tr class=''><td class='line-number'>332</td><td class='line-content'>       :parameter 'nskk-completion-limit</td></tr>
<tr class='covered'><td class='line-number'>333</td><td class='line-content'>       :current current-limit</td></tr>
<tr class='covered'><td class='line-number'>334</td><td class='line-content'>       :suggested suggested-limit</td></tr>
<tr class='covered'><td class='line-number'>335</td><td class='line-content'>       :reason (format &amp;quot;Based on conversion speed (%.3fs)&amp;quot; speed)</td></tr>
<tr class=''><td class='line-number'>336</td><td class='line-content'>       :impact 'low</td></tr>
<tr class='covered'><td class='line-number'>337</td><td class='line-content'>       :confidence 0.6))))</td></tr>
<tr class=''><td class='line-number'>338</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>339</td><td class='line-content'>(defun nskk-analytics-optimize--suggest-history-size (patterns)</td></tr>
<tr class=''><td class='line-number'>340</td><td class='line-content'>  &amp;quot;履歴サイズの最適化を提案する。</td></tr>
<tr class=''><td class='line-number'>341</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>342</td><td class='line-content'>PATTERNS: パターンのalist</td></tr>
<tr class=''><td class='line-number'>343</td><td class='line-content'>戻り値: 最適化提案またはnil&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>344</td><td class='line-content'>  (let* ((freq-conv (alist-get 'frequent-conversions patterns))</td></tr>
<tr class='covered'><td class='line-number'>345</td><td class='line-content'>         (current-size (or (bound-and-true-p nskk-history-size) 1000))</td></tr>
<tr class='covered'><td class='line-number'>346</td><td class='line-content'>         (suggested-size (max 1000 (min 10000 (* (length freq-conv) 50)))))</td></tr>
<tr class=''><td class='line-number'>347</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>348</td><td class='line-content'>    (when (&amp;gt; (abs (- suggested-size current-size)) 500)</td></tr>
<tr class='covered'><td class='line-number'>349</td><td class='line-content'>      (nskk-analytics-optimization-create</td></tr>
<tr class=''><td class='line-number'>350</td><td class='line-content'>       :parameter 'nskk-history-size</td></tr>
<tr class='uncovered'><td class='line-number'>351</td><td class='line-content'>       :current current-size</td></tr>
<tr class='uncovered'><td class='line-number'>352</td><td class='line-content'>       :suggested suggested-size</td></tr>
<tr class='covered'><td class='line-number'>353</td><td class='line-content'>       :reason (format &amp;quot;Based on %d frequent conversions&amp;quot; (length freq-conv))</td></tr>
<tr class=''><td class='line-number'>354</td><td class='line-content'>       :impact 'low</td></tr>
<tr class='covered'><td class='line-number'>355</td><td class='line-content'>       :confidence 0.5))))</td></tr>
<tr class=''><td class='line-number'>356</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>357</td><td class='line-content'>(defun nskk-analytics-optimize--display-suggestions (suggestions)</td></tr>
<tr class=''><td class='line-number'>358</td><td class='line-content'>  &amp;quot;最適化提案を表示する。</td></tr>
<tr class=''><td class='line-number'>359</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>360</td><td class='line-content'>SUGGESTIONS: 最適化提案のリスト&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>361</td><td class='line-content'>  (with-current-buffer (get-buffer-create &amp;quot;*NSKK Optimizations*&amp;quot;)</td></tr>
<tr class='covered'><td class='line-number'>362</td><td class='line-content'>    (erase-buffer)</td></tr>
<tr class='onevalue'><td class='line-number'>363</td><td class='line-content'>    (insert &amp;quot;=== NSKK Optimization Suggestions ===\n\n&amp;quot;)</td></tr>
<tr class=''><td class='line-number'>364</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>365</td><td class='line-content'>    (if (null suggestions)</td></tr>
<tr class='onevalue'><td class='line-number'>366</td><td class='line-content'>        (insert &amp;quot;No optimizations suggested at this time.\n&amp;quot;)</td></tr>
<tr class='covered'><td class='line-number'>367</td><td class='line-content'>      (dolist (opt suggestions)</td></tr>
<tr class='onevalue'><td class='line-number'>368</td><td class='line-content'>        (insert (format &amp;quot;Parameter: %s\n&amp;quot; (nskk-analytics-optimization-parameter opt)))</td></tr>
<tr class='onevalue'><td class='line-number'>369</td><td class='line-content'>        (insert (format &amp;quot;  Current:    %s\n&amp;quot; (nskk-analytics-optimization-current opt)))</td></tr>
<tr class='onevalue'><td class='line-number'>370</td><td class='line-content'>        (insert (format &amp;quot;  Suggested:  %s\n&amp;quot; (nskk-analytics-optimization-suggested opt)))</td></tr>
<tr class='onevalue'><td class='line-number'>371</td><td class='line-content'>        (insert (format &amp;quot;  Reason:     %s\n&amp;quot; (nskk-analytics-optimization-reason opt)))</td></tr>
<tr class='onevalue'><td class='line-number'>372</td><td class='line-content'>        (insert (format &amp;quot;  Impact:     %s\n&amp;quot; (nskk-analytics-optimization-impact opt)))</td></tr>
<tr class='covered'><td class='line-number'>373</td><td class='line-content'>        (insert (format &amp;quot;  Confidence: %.0f%%\n\n&amp;quot;</td></tr>
<tr class='onevalue'><td class='line-number'>374</td><td class='line-content'>                        (* (nskk-analytics-optimization-confidence opt) 100)))))</td></tr>
<tr class=''><td class='line-number'>375</td><td class='line-content'></td></tr>
<tr class='onevalue'><td class='line-number'>376</td><td class='line-content'>    (insert &amp;quot;\nTo apply these optimizations, run: M-x nskk-analytics-apply-optimizations\n&amp;quot;)</td></tr>
<tr class=''><td class='line-number'>377</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>378</td><td class='line-content'>    (goto-char (point-min))</td></tr>
<tr class='covered'><td class='line-number'>379</td><td class='line-content'>    (display-buffer (current-buffer))))</td></tr>
<tr class=''><td class='line-number'>380</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>381</td><td class='line-content'>;;;###autoload</td></tr>
<tr class=''><td class='line-number'>382</td><td class='line-content'>(defun nskk-analytics-apply-optimizations (&amp;optional optimizations)</td></tr>
<tr class=''><td class='line-number'>383</td><td class='line-content'>  &amp;quot;最適化提案を適用する。</td></tr>
<tr class=''><td class='line-number'>384</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>385</td><td class='line-content'>OPTIMIZATIONS: 適用する最適化リスト（nilの場合は全提案）&amp;quot;</td></tr>
<tr class=''><td class='line-number'>386</td><td class='line-content'>  (interactive)</td></tr>
<tr class='covered'><td class='line-number'>387</td><td class='line-content'>  (let ((opts (or optimizations nskk-analytics-optimize--optimizations)))</td></tr>
<tr class='covered'><td class='line-number'>388</td><td class='line-content'>    (when (null opts)</td></tr>
<tr class='covered'><td class='line-number'>389</td><td class='line-content'>      (setq opts (nskk-analytics-suggest-optimizations)))</td></tr>
<tr class=''><td class='line-number'>390</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>391</td><td class='line-content'>    (if (null opts)</td></tr>
<tr class='onevalue'><td class='line-number'>392</td><td class='line-content'>        (message &amp;quot;No optimizations to apply&amp;quot;)</td></tr>
<tr class='covered'><td class='line-number'>393</td><td class='line-content'>      (when (or nskk-analytics-optimize-auto-apply</td></tr>
<tr class='covered'><td class='line-number'>394</td><td class='line-content'>                (yes-or-no-p (format &amp;quot;Apply %d optimizations? &amp;quot; (length opts))))</td></tr>
<tr class='covered'><td class='line-number'>395</td><td class='line-content'>        (dolist (opt opts)</td></tr>
<tr class='covered'><td class='line-number'>396</td><td class='line-content'>          (set (nskk-analytics-optimization-parameter opt)</td></tr>
<tr class='covered'><td class='line-number'>397</td><td class='line-content'>               (nskk-analytics-optimization-suggested opt))</td></tr>
<tr class='covered'><td class='line-number'>398</td><td class='line-content'>          (message &amp;quot;Applied: %s = %s&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>399</td><td class='line-content'>                   (nskk-analytics-optimization-parameter opt)</td></tr>
<tr class='onevalue'><td class='line-number'>400</td><td class='line-content'>                   (nskk-analytics-optimization-suggested opt)))</td></tr>
<tr class='covered'><td class='line-number'>401</td><td class='line-content'>        (message &amp;quot;Applied %d optimizations&amp;quot; (length opts))))))</td></tr>
<tr class=''><td class='line-number'>402</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>403</td><td class='line-content'>;;;###autoload</td></tr>
<tr class=''><td class='line-number'>404</td><td class='line-content'>(defun nskk-analytics-auto-optimize ()</td></tr>
<tr class=''><td class='line-number'>405</td><td class='line-content'>  &amp;quot;自動最適化を実行する（提案→適用）。&amp;quot;</td></tr>
<tr class=''><td class='line-number'>406</td><td class='line-content'>  (interactive)</td></tr>
<tr class='covered'><td class='line-number'>407</td><td class='line-content'>  (let ((suggestions (nskk-analytics-suggest-optimizations)))</td></tr>
<tr class='covered'><td class='line-number'>408</td><td class='line-content'>    (when suggestions</td></tr>
<tr class='covered'><td class='line-number'>409</td><td class='line-content'>      (nskk-analytics-apply-optimizations suggestions))))</td></tr>
<tr class=''><td class='line-number'>410</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>411</td><td class='line-content'>;;; パラメータチューニング</td></tr>
<tr class=''><td class='line-number'>412</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>413</td><td class='line-content'>(defun nskk-analytics-optimize-parameter (parameter)</td></tr>
<tr class=''><td class='line-number'>414</td><td class='line-content'>  &amp;quot;特定のパラメータを最適化する。</td></tr>
<tr class=''><td class='line-number'>415</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>416</td><td class='line-content'>PARAMETER: パラメータ名（シンボル）&amp;quot;</td></tr>
<tr class=''><td class='line-number'>417</td><td class='line-content'>  (interactive</td></tr>
<tr class='covered'><td class='line-number'>418</td><td class='line-content'>   (list (intern (completing-read &amp;quot;Parameter: &amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>419</td><td class='line-content'>                                  (mapcar #'car nskk-analytics-optimize--parameters)))))</td></tr>
<tr class='covered'><td class='line-number'>420</td><td class='line-content'>  (let* ((range (alist-get parameter nskk-analytics-optimize--parameters))</td></tr>
<tr class='covered'><td class='line-number'>421</td><td class='line-content'>         (current (symbol-value parameter))</td></tr>
<tr class='uncovered'><td class='line-number'>422</td><td class='line-content'>         (best-value current)</td></tr>
<tr class=''><td class='line-number'>423</td><td class='line-content'>         (best-score 0.0))</td></tr>
<tr class=''><td class='line-number'>424</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>425</td><td class='line-content'>    (when range</td></tr>
<tr class=''><td class='line-number'>426</td><td class='line-content'>      ;; グリッドサーチ（簡易的）</td></tr>
<tr class='covered'><td class='line-number'>427</td><td class='line-content'>      (let ((min-val (car range))</td></tr>
<tr class='covered'><td class='line-number'>428</td><td class='line-content'>            (max-val (cadr range))</td></tr>
<tr class=''><td class='line-number'>429</td><td class='line-content'>            (steps 5))</td></tr>
<tr class='covered'><td class='line-number'>430</td><td class='line-content'>        (dotimes (i steps)</td></tr>
<tr class='covered'><td class='line-number'>431</td><td class='line-content'>          (let* ((test-value (+ min-val (* (/ (- max-val min-val) (float steps)) i)))</td></tr>
<tr class='covered'><td class='line-number'>432</td><td class='line-content'>                 (score (nskk-analytics-optimize--evaluate-parameter-value</td></tr>
<tr class='uncovered'><td class='line-number'>433</td><td class='line-content'>                         parameter test-value)))</td></tr>
<tr class='covered'><td class='line-number'>434</td><td class='line-content'>            (when (&amp;gt; score best-score)</td></tr>
<tr class='covered'><td class='line-number'>435</td><td class='line-content'>              (setq best-value test-value</td></tr>
<tr class='onevalue'><td class='line-number'>436</td><td class='line-content'>                    best-score score)))))</td></tr>
<tr class=''><td class='line-number'>437</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>438</td><td class='line-content'>      (when (not (eq best-value current))</td></tr>
<tr class='covered'><td class='line-number'>439</td><td class='line-content'>        (message &amp;quot;Optimal value for %s: %s (current: %s, score: %.2f)&amp;quot;</td></tr>
<tr class='uncovered'><td class='line-number'>440</td><td class='line-content'>                 parameter best-value current best-score)</td></tr>
<tr class='covered'><td class='line-number'>441</td><td class='line-content'>        (when (yes-or-no-p (format &amp;quot;Apply optimization %s = %s? &amp;quot; parameter best-value))</td></tr>
<tr class='covered'><td class='line-number'>442</td><td class='line-content'>          (set parameter best-value))))))</td></tr>
<tr class=''><td class='line-number'>443</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>444</td><td class='line-content'>(defun nskk-analytics-optimize--evaluate-parameter-value (parameter value)</td></tr>
<tr class=''><td class='line-number'>445</td><td class='line-content'>  &amp;quot;パラメータ値を評価する。</td></tr>
<tr class=''><td class='line-number'>446</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>447</td><td class='line-content'>PARAMETER: パラメータ名</td></tr>
<tr class=''><td class='line-number'>448</td><td class='line-content'>VALUE: テスト値</td></tr>
<tr class=''><td class='line-number'>449</td><td class='line-content'>戻り値: スコア（0.0-1.0）&amp;quot;</td></tr>
<tr class=''><td class='line-number'>450</td><td class='line-content'>  ;; 実際の実装ではパラメータを一時的に変更して性能測定</td></tr>
<tr class=''><td class='line-number'>451</td><td class='line-content'>  ;; ここでは簡易的なヒューリスティックスコアを返す</td></tr>
<tr class='covered'><td class='line-number'>452</td><td class='line-content'>  (let ((current (symbol-value parameter)))</td></tr>
<tr class='covered'><td class='line-number'>453</td><td class='line-content'>    (set parameter value)</td></tr>
<tr class='covered'><td class='line-number'>454</td><td class='line-content'>    (sleep-for 0.1)  ;; 短時間テスト</td></tr>
<tr class='covered'><td class='line-number'>455</td><td class='line-content'>    (let ((metrics (nskk-analytics-collect-metrics))</td></tr>
<tr class=''><td class='line-number'>456</td><td class='line-content'>          (score 0.0))</td></tr>
<tr class='covered'><td class='line-number'>457</td><td class='line-content'>      (setq score (/ 1.0 (1+ (nskk-analytics-metrics-speed metrics))))</td></tr>
<tr class='covered'><td class='line-number'>458</td><td class='line-content'>      (set parameter current)  ;; 元に戻す</td></tr>
<tr class='uncovered'><td class='line-number'>459</td><td class='line-content'>      score)))</td></tr>
<tr class=''><td class='line-number'>460</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>461</td><td class='line-content'>(provide 'nskk-analytics-optimize)</td></tr>
<tr class=''><td class='line-number'>462</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>463</td><td class='line-content'>;;; nskk-analytics-optimize.el ends here</td></tr>

    </table>
  </div>
  <div class='legend'>
    <div class='legend-item'><span class='legend-color' style='background: #e8f5e9;'></span>Covered</div>
    <div class='legend-item'><span class='legend-color' style='background: #ffebee;'></span>Uncovered</div>
    <div class='legend-item'><span class='legend-color' style='background: #fff3e0;'></span>1-Value</div>
    <div class='legend-item'><span class='legend-color' style='background: #f3e5f5;'></span>No-Return</div>
  </div>
</body>
</html>