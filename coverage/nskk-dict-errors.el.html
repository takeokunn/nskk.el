<!DOCTYPE html>
<html lang='ja'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>Coverage: nskk-dict-errors.el</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Monaco', 'Courier New', monospace; background: #f5f5f5; }
    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px 30px; }
    .header h1 { font-size: 24px; margin-bottom: 10px; }
    .header .stats { font-size: 14px; opacity: 0.9; }
    .header a { color: white; text-decoration: underline; }
    .container { max-width: 1400px; margin: 20px auto; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; font-family: 'Monaco', 'Courier New', monospace; font-size: 13px; }
    td.line-number { background: #f0f0f0; color: #666; padding: 2px 10px; text-align: right; border-right: 2px solid #ddd; user-select: none; width: 60px; }
    td.line-content { padding: 2px 10px; white-space: pre; }
    tr.covered { background: #e8f5e9; }
    tr.uncovered { background: #ffebee; }
    tr.onevalue { background: #fff3e0; }
    tr.noreturn { background: #f3e5f5; }
    tr:hover { opacity: 0.9; }
    .legend { padding: 15px 30px; background: #fafafa; border-top: 1px solid #e0e0e0; font-size: 12px; }
    .legend-item { display: inline-block; margin-right: 20px; }
    .legend-color { display: inline-block; width: 20px; height: 12px; margin-right: 5px; vertical-align: middle; }
  </style>
</head>
<body>
  <div class='header'>
    <h1>nskk-dict-errors.el</h1>
    <div class='stats'>
      Coverage: 81.07% (561/692 forms) •
      <a href='index.html'>← Back to Index</a>
    </div>
  </div>
  <div class='container'>
    <table>
<tr class=''><td class='line-number'>1</td><td class='line-content'>;;; nskk-dict-errors.el --- Error handling for SKK dictionary operations -*- lexical-binding: t; -*-</td></tr>
<tr class=''><td class='line-number'>2</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>3</td><td class='line-content'>;; Copyright (C) 2024 NSKK Development Team</td></tr>
<tr class=''><td class='line-number'>4</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>5</td><td class='line-content'>;; Author: NSKK Development Team</td></tr>
<tr class=''><td class='line-number'>6</td><td class='line-content'>;; Keywords: japanese, input method, skk, dictionary, errors</td></tr>
<tr class=''><td class='line-number'>7</td><td class='line-content'>;; Version: 0.1.0</td></tr>
<tr class=''><td class='line-number'>8</td><td class='line-content'>;; Package-Requires: ((emacs &amp;quot;31.0&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>9</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>10</td><td class='line-content'>;; This file is part of NSKK.</td></tr>
<tr class=''><td class='line-number'>11</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>12</td><td class='line-content'>;; NSKK is free software: you can redistribute it and/or modify</td></tr>
<tr class=''><td class='line-number'>13</td><td class='line-content'>;; it under the terms of the GNU General Public License as published by</td></tr>
<tr class=''><td class='line-number'>14</td><td class='line-content'>;; the Free Software Foundation, either version 3 of the License, or</td></tr>
<tr class=''><td class='line-number'>15</td><td class='line-content'>;; (at your option) any later version.</td></tr>
<tr class=''><td class='line-number'>16</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>17</td><td class='line-content'>;; NSKK is distributed in the hope that it will be useful,</td></tr>
<tr class=''><td class='line-number'>18</td><td class='line-content'>;; but WITHOUT ANY WARRANTY; without even the implied warranty of</td></tr>
<tr class=''><td class='line-number'>19</td><td class='line-content'>;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td></tr>
<tr class=''><td class='line-number'>20</td><td class='line-content'>;; GNU General Public License for more details.</td></tr>
<tr class=''><td class='line-number'>21</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>22</td><td class='line-content'>;; You should have received a copy of the GNU General Public License</td></tr>
<tr class=''><td class='line-number'>23</td><td class='line-content'>;; along with NSKK.  If not, see &amp;lt;https://www.gnu.org/licenses/&amp;gt;.</td></tr>
<tr class=''><td class='line-number'>24</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>25</td><td class='line-content'>;;; Commentary:</td></tr>
<tr class=''><td class='line-number'>26</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>27</td><td class='line-content'>;; このファイルはSKK辞書システムの包括的なエラーハンドリング機構を実装します。</td></tr>
<tr class=''><td class='line-number'>28</td><td class='line-content'>;;</td></tr>
<tr class=''><td class='line-number'>29</td><td class='line-content'>;; 特徴:</td></tr>
<tr class=''><td class='line-number'>30</td><td class='line-content'>;; - 階層的なカスタムエラー型定義</td></tr>
<tr class=''><td class='line-number'>31</td><td class='line-content'>;; - 自動エラーリカバリー機構</td></tr>
<tr class=''><td class='line-number'>32</td><td class='line-content'>;; - フォールバック辞書機能</td></tr>
<tr class=''><td class='line-number'>33</td><td class='line-content'>;; - エラーロギング・監視</td></tr>
<tr class=''><td class='line-number'>34</td><td class='line-content'>;; - ユーザーフレンドリーな通知</td></tr>
<tr class=''><td class='line-number'>35</td><td class='line-content'>;;</td></tr>
<tr class=''><td class='line-number'>36</td><td class='line-content'>;; カスタムエラー型階層:</td></tr>
<tr class=''><td class='line-number'>37</td><td class='line-content'>;;</td></tr>
<tr class=''><td class='line-number'>38</td><td class='line-content'>;;   nskk-dict-error (ベース)</td></tr>
<tr class=''><td class='line-number'>39</td><td class='line-content'>;;     ├─ nskk-dict-io-error (I/O関連)</td></tr>
<tr class=''><td class='line-number'>40</td><td class='line-content'>;;     │   ├─ nskk-dict-io-file-not-found</td></tr>
<tr class=''><td class='line-number'>41</td><td class='line-content'>;;     │   ├─ nskk-dict-io-permission-denied</td></tr>
<tr class=''><td class='line-number'>42</td><td class='line-content'>;;     │   ├─ nskk-dict-io-checksum-mismatch</td></tr>
<tr class=''><td class='line-number'>43</td><td class='line-content'>;;     │   └─ nskk-dict-io-backup-failed</td></tr>
<tr class=''><td class='line-number'>44</td><td class='line-content'>;;     ├─ nskk-dict-parse-error (パース関連)</td></tr>
<tr class=''><td class='line-number'>45</td><td class='line-content'>;;     │   ├─ nskk-dict-parse-invalid-format</td></tr>
<tr class=''><td class='line-number'>46</td><td class='line-content'>;;     │   └─ nskk-dict-parse-encoding-error</td></tr>
<tr class=''><td class='line-number'>47</td><td class='line-content'>;;     └─ nskk-dict-struct-error (構造関連)</td></tr>
<tr class=''><td class='line-number'>48</td><td class='line-content'>;;         └─ nskk-dict-struct-invalid-entry</td></tr>
<tr class=''><td class='line-number'>49</td><td class='line-content'>;;</td></tr>
<tr class=''><td class='line-number'>50</td><td class='line-content'>;; リカバリー戦略:</td></tr>
<tr class=''><td class='line-number'>51</td><td class='line-content'>;;</td></tr>
<tr class=''><td class='line-number'>52</td><td class='line-content'>;;   - ファイルなし          → フォールバック辞書を使用</td></tr>
<tr class=''><td class='line-number'>53</td><td class='line-content'>;;   - パースエラー          → バックアップから復旧</td></tr>
<tr class=''><td class='line-number'>54</td><td class='line-content'>;;   - チェックサム不一致    → 強制再読み込み</td></tr>
<tr class=''><td class='line-number'>55</td><td class='line-content'>;;   - 権限エラー            → 読み取り専用モード</td></tr>
<tr class=''><td class='line-number'>56</td><td class='line-content'>;;   - エンコーディングエラー → 別エンコーディングで再試行</td></tr>
<tr class=''><td class='line-number'>57</td><td class='line-content'>;;</td></tr>
<tr class=''><td class='line-number'>58</td><td class='line-content'>;; 使用例:</td></tr>
<tr class=''><td class='line-number'>59</td><td class='line-content'>;;</td></tr>
<tr class=''><td class='line-number'>60</td><td class='line-content'>;;   (require 'nskk-dict-errors)</td></tr>
<tr class=''><td class='line-number'>61</td><td class='line-content'>;;</td></tr>
<tr class=''><td class='line-number'>62</td><td class='line-content'>;;   ;; エラーリカバリー付きで辞書読み込み</td></tr>
<tr class=''><td class='line-number'>63</td><td class='line-content'>;;   (let ((index (nskk-dict-errors-load-with-recovery &amp;quot;/path/to/dict&amp;quot;)))</td></tr>
<tr class=''><td class='line-number'>64</td><td class='line-content'>;;     ;; 失敗時はフォールバック辞書が返される</td></tr>
<tr class=''><td class='line-number'>65</td><td class='line-content'>;;     (message &amp;quot;Loaded: %s&amp;quot; index))</td></tr>
<tr class=''><td class='line-number'>66</td><td class='line-content'>;;</td></tr>
<tr class=''><td class='line-number'>67</td><td class='line-content'>;;   ;; カスタムエラーのシグナル</td></tr>
<tr class=''><td class='line-number'>68</td><td class='line-content'>;;   (signal 'nskk-dict-io-file-not-found (list &amp;quot;/path/to/dict&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>69</td><td class='line-content'>;;</td></tr>
<tr class=''><td class='line-number'>70</td><td class='line-content'>;;   ;; エラーログの表示</td></tr>
<tr class=''><td class='line-number'>71</td><td class='line-content'>;;   (nskk-dict-errors-show-log)</td></tr>
<tr class=''><td class='line-number'>72</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>73</td><td class='line-content'>;;; Code:</td></tr>
<tr class=''><td class='line-number'>74</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>75</td><td class='line-content'>(require 'cl-lib)</td></tr>
<tr class=''><td class='line-number'>76</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>77</td><td class='line-content'>;;; カスタマイズ変数</td></tr>
<tr class=''><td class='line-number'>78</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>79</td><td class='line-content'>(defgroup nskk-dict-errors nil</td></tr>
<tr class=''><td class='line-number'>80</td><td class='line-content'>  &amp;quot;SKK dictionary error handling customization.&amp;quot;</td></tr>
<tr class=''><td class='line-number'>81</td><td class='line-content'>  :group 'nskk</td></tr>
<tr class=''><td class='line-number'>82</td><td class='line-content'>  :prefix &amp;quot;nskk-dict-errors-&amp;quot;)</td></tr>
<tr class=''><td class='line-number'>83</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>84</td><td class='line-content'>(defcustom nskk-dict-errors-fallback-dict-path nil</td></tr>
<tr class=''><td class='line-number'>85</td><td class='line-content'>  &amp;quot;フォールバック辞書のパス。</td></tr>
<tr class=''><td class='line-number'>86</td><td class='line-content'>nilの場合、最小限の組み込み辞書を使用。&amp;quot;</td></tr>
<tr class=''><td class='line-number'>87</td><td class='line-content'>  :type '(choice (const :tag &amp;quot;Built-in minimal&amp;quot; nil)</td></tr>
<tr class=''><td class='line-number'>88</td><td class='line-content'>                 (file :tag &amp;quot;Custom fallback&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>89</td><td class='line-content'>  :group 'nskk-dict-errors)</td></tr>
<tr class=''><td class='line-number'>90</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>91</td><td class='line-content'>(defcustom nskk-dict-errors-enable-logging t</td></tr>
<tr class=''><td class='line-number'>92</td><td class='line-content'>  &amp;quot;非nilの場合、エラーログを記録する。&amp;quot;</td></tr>
<tr class=''><td class='line-number'>93</td><td class='line-content'>  :type 'boolean</td></tr>
<tr class=''><td class='line-number'>94</td><td class='line-content'>  :group 'nskk-dict-errors)</td></tr>
<tr class=''><td class='line-number'>95</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>96</td><td class='line-content'>(defcustom nskk-dict-errors-log-file &amp;quot;~/.nskk/error.log&amp;quot;</td></tr>
<tr class=''><td class='line-number'>97</td><td class='line-content'>  &amp;quot;エラーログファイルのパス。&amp;quot;</td></tr>
<tr class=''><td class='line-number'>98</td><td class='line-content'>  :type 'file</td></tr>
<tr class=''><td class='line-number'>99</td><td class='line-content'>  :group 'nskk-dict-errors)</td></tr>
<tr class=''><td class='line-number'>100</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>101</td><td class='line-content'>(defcustom nskk-dict-errors-notification-method 'message</td></tr>
<tr class=''><td class='line-number'>102</td><td class='line-content'>  &amp;quot;エラー通知方法。</td></tr>
<tr class=''><td class='line-number'>103</td><td class='line-content'>- 'message: ミニバッファに表示</td></tr>
<tr class=''><td class='line-number'>104</td><td class='line-content'>- 'popup: ポップアップ表示（将来実装）</td></tr>
<tr class=''><td class='line-number'>105</td><td class='line-content'>- 'silent: 通知しない（ログのみ）&amp;quot;</td></tr>
<tr class=''><td class='line-number'>106</td><td class='line-content'>  :type '(choice (const message)</td></tr>
<tr class=''><td class='line-number'>107</td><td class='line-content'>                 (const popup)</td></tr>
<tr class=''><td class='line-number'>108</td><td class='line-content'>                 (const silent))</td></tr>
<tr class=''><td class='line-number'>109</td><td class='line-content'>  :group 'nskk-dict-errors)</td></tr>
<tr class=''><td class='line-number'>110</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>111</td><td class='line-content'>(defcustom nskk-dict-errors-auto-recovery t</td></tr>
<tr class=''><td class='line-number'>112</td><td class='line-content'>  &amp;quot;非nilの場合、エラー時に自動リカバリーを試みる。&amp;quot;</td></tr>
<tr class=''><td class='line-number'>113</td><td class='line-content'>  :type 'boolean</td></tr>
<tr class=''><td class='line-number'>114</td><td class='line-content'>  :group 'nskk-dict-errors)</td></tr>
<tr class=''><td class='line-number'>115</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>116</td><td class='line-content'>(defcustom nskk-dict-errors-max-recovery-attempts 3</td></tr>
<tr class=''><td class='line-number'>117</td><td class='line-content'>  &amp;quot;最大リカバリー試行回数。&amp;quot;</td></tr>
<tr class=''><td class='line-number'>118</td><td class='line-content'>  :type 'integer</td></tr>
<tr class=''><td class='line-number'>119</td><td class='line-content'>  :group 'nskk-dict-errors)</td></tr>
<tr class=''><td class='line-number'>120</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>121</td><td class='line-content'>;;; エラー型定義</td></tr>
<tr class=''><td class='line-number'>122</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>123</td><td class='line-content'>;; ベースエラー型</td></tr>
<tr class=''><td class='line-number'>124</td><td class='line-content'>(define-error 'nskk-dict-error</td></tr>
<tr class=''><td class='line-number'>125</td><td class='line-content'>  &amp;quot;SKK辞書エラー&amp;quot;</td></tr>
<tr class=''><td class='line-number'>126</td><td class='line-content'>  'error)</td></tr>
<tr class=''><td class='line-number'>127</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>128</td><td class='line-content'>;; I/Oエラー</td></tr>
<tr class=''><td class='line-number'>129</td><td class='line-content'>(define-error 'nskk-dict-io-error</td></tr>
<tr class=''><td class='line-number'>130</td><td class='line-content'>  &amp;quot;辞書I/Oエラー&amp;quot;</td></tr>
<tr class=''><td class='line-number'>131</td><td class='line-content'>  'nskk-dict-error)</td></tr>
<tr class=''><td class='line-number'>132</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>133</td><td class='line-content'>(define-error 'nskk-dict-io-file-not-found</td></tr>
<tr class=''><td class='line-number'>134</td><td class='line-content'>  &amp;quot;辞書ファイルが見つかりません&amp;quot;</td></tr>
<tr class=''><td class='line-number'>135</td><td class='line-content'>  'nskk-dict-io-error)</td></tr>
<tr class=''><td class='line-number'>136</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>137</td><td class='line-content'>(define-error 'nskk-dict-io-permission-denied</td></tr>
<tr class=''><td class='line-number'>138</td><td class='line-content'>  &amp;quot;権限がありません&amp;quot;</td></tr>
<tr class=''><td class='line-number'>139</td><td class='line-content'>  'nskk-dict-io-error)</td></tr>
<tr class=''><td class='line-number'>140</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>141</td><td class='line-content'>(define-error 'nskk-dict-io-checksum-mismatch</td></tr>
<tr class=''><td class='line-number'>142</td><td class='line-content'>  &amp;quot;チェックサムが一致しません&amp;quot;</td></tr>
<tr class=''><td class='line-number'>143</td><td class='line-content'>  'nskk-dict-io-error)</td></tr>
<tr class=''><td class='line-number'>144</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>145</td><td class='line-content'>(define-error 'nskk-dict-io-backup-failed</td></tr>
<tr class=''><td class='line-number'>146</td><td class='line-content'>  &amp;quot;バックアップに失敗しました&amp;quot;</td></tr>
<tr class=''><td class='line-number'>147</td><td class='line-content'>  'nskk-dict-io-error)</td></tr>
<tr class=''><td class='line-number'>148</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>149</td><td class='line-content'>;; パースエラー</td></tr>
<tr class=''><td class='line-number'>150</td><td class='line-content'>(define-error 'nskk-dict-parse-error</td></tr>
<tr class=''><td class='line-number'>151</td><td class='line-content'>  &amp;quot;辞書パースエラー&amp;quot;</td></tr>
<tr class=''><td class='line-number'>152</td><td class='line-content'>  'nskk-dict-error)</td></tr>
<tr class=''><td class='line-number'>153</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>154</td><td class='line-content'>(define-error 'nskk-dict-parse-invalid-format</td></tr>
<tr class=''><td class='line-number'>155</td><td class='line-content'>  &amp;quot;辞書フォーマットが不正です&amp;quot;</td></tr>
<tr class=''><td class='line-number'>156</td><td class='line-content'>  'nskk-dict-parse-error)</td></tr>
<tr class=''><td class='line-number'>157</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>158</td><td class='line-content'>(define-error 'nskk-dict-parse-encoding-error</td></tr>
<tr class=''><td class='line-number'>159</td><td class='line-content'>  &amp;quot;エンコーディングエラー&amp;quot;</td></tr>
<tr class=''><td class='line-number'>160</td><td class='line-content'>  'nskk-dict-parse-error)</td></tr>
<tr class=''><td class='line-number'>161</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>162</td><td class='line-content'>;; 構造エラー</td></tr>
<tr class=''><td class='line-number'>163</td><td class='line-content'>(define-error 'nskk-dict-struct-error</td></tr>
<tr class=''><td class='line-number'>164</td><td class='line-content'>  &amp;quot;辞書構造エラー&amp;quot;</td></tr>
<tr class=''><td class='line-number'>165</td><td class='line-content'>  'nskk-dict-error)</td></tr>
<tr class=''><td class='line-number'>166</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>167</td><td class='line-content'>(define-error 'nskk-dict-struct-invalid-entry</td></tr>
<tr class=''><td class='line-number'>168</td><td class='line-content'>  &amp;quot;不正な辞書エントリです&amp;quot;</td></tr>
<tr class=''><td class='line-number'>169</td><td class='line-content'>  'nskk-dict-struct-error)</td></tr>
<tr class=''><td class='line-number'>170</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>171</td><td class='line-content'>;;; エラー情報構造</td></tr>
<tr class=''><td class='line-number'>172</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>173</td><td class='line-content'>(cl-defstruct (nskk-dict-error-info</td></tr>
<tr class=''><td class='line-number'>174</td><td class='line-content'>               (:constructor nskk-dict-error-info--create)</td></tr>
<tr class=''><td class='line-number'>175</td><td class='line-content'>               (:copier nil))</td></tr>
<tr class=''><td class='line-number'>176</td><td class='line-content'>  &amp;quot;エラー情報オブジェクト。</td></tr>
<tr class=''><td class='line-number'>177</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>178</td><td class='line-content'>スロット:</td></tr>
<tr class=''><td class='line-number'>179</td><td class='line-content'>  type      - エラー型シンボル</td></tr>
<tr class=''><td class='line-number'>180</td><td class='line-content'>  message   - エラーメッセージ</td></tr>
<tr class=''><td class='line-number'>181</td><td class='line-content'>  data      - エラーデータ（任意）</td></tr>
<tr class=''><td class='line-number'>182</td><td class='line-content'>  timestamp - 発生時刻&amp;quot;</td></tr>
<tr class=''><td class='line-number'>183</td><td class='line-content'>  (type nil :type symbol)</td></tr>
<tr class=''><td class='line-number'>184</td><td class='line-content'>  (message nil :type string)</td></tr>
<tr class=''><td class='line-number'>185</td><td class='line-content'>  (data nil :type list)</td></tr>
<tr class=''><td class='line-number'>186</td><td class='line-content'>  (timestamp nil :type float))</td></tr>
<tr class=''><td class='line-number'>187</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>188</td><td class='line-content'>;;; フォールバック辞書</td></tr>
<tr class=''><td class='line-number'>189</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>190</td><td class='line-content'>(defvar nskk-dict-errors--builtin-dict</td></tr>
<tr class=''><td class='line-number'>191</td><td class='line-content'>  '(;; 基本的なひらがな</td></tr>
<tr class=''><td class='line-number'>192</td><td class='line-content'>    (&amp;quot;あ&amp;quot; (&amp;quot;亜&amp;quot; &amp;quot;阿&amp;quot; &amp;quot;吾&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>193</td><td class='line-content'>    (&amp;quot;い&amp;quot; (&amp;quot;以&amp;quot; &amp;quot;伊&amp;quot; &amp;quot;位&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>194</td><td class='line-content'>    (&amp;quot;う&amp;quot; (&amp;quot;宇&amp;quot; &amp;quot;羽&amp;quot; &amp;quot;右&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>195</td><td class='line-content'>    (&amp;quot;え&amp;quot; (&amp;quot;江&amp;quot; &amp;quot;絵&amp;quot; &amp;quot;恵&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>196</td><td class='line-content'>    (&amp;quot;お&amp;quot; (&amp;quot;於&amp;quot; &amp;quot;尾&amp;quot; &amp;quot;御&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>197</td><td class='line-content'>    (&amp;quot;か&amp;quot; (&amp;quot;可&amp;quot; &amp;quot;仮&amp;quot; &amp;quot;加&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>198</td><td class='line-content'>    (&amp;quot;き&amp;quot; (&amp;quot;木&amp;quot; &amp;quot;気&amp;quot; &amp;quot;基&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>199</td><td class='line-content'>    (&amp;quot;く&amp;quot; (&amp;quot;区&amp;quot; &amp;quot;句&amp;quot; &amp;quot;苦&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>200</td><td class='line-content'>    (&amp;quot;け&amp;quot; (&amp;quot;家&amp;quot; &amp;quot;毛&amp;quot; &amp;quot;化&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>201</td><td class='line-content'>    (&amp;quot;こ&amp;quot; (&amp;quot;子&amp;quot; &amp;quot;個&amp;quot; &amp;quot;古&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>202</td><td class='line-content'>    (&amp;quot;さ&amp;quot; (&amp;quot;左&amp;quot; &amp;quot;差&amp;quot; &amp;quot;沙&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>203</td><td class='line-content'>    (&amp;quot;し&amp;quot; (&amp;quot;四&amp;quot; &amp;quot;子&amp;quot; &amp;quot;詩&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>204</td><td class='line-content'>    (&amp;quot;す&amp;quot; (&amp;quot;図&amp;quot; &amp;quot;須&amp;quot; &amp;quot;数&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>205</td><td class='line-content'>    (&amp;quot;せ&amp;quot; (&amp;quot;世&amp;quot; &amp;quot;瀬&amp;quot; &amp;quot;施&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>206</td><td class='line-content'>    (&amp;quot;そ&amp;quot; (&amp;quot;素&amp;quot; &amp;quot;祖&amp;quot; &amp;quot;阻&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>207</td><td class='line-content'>    (&amp;quot;た&amp;quot; (&amp;quot;田&amp;quot; &amp;quot;他&amp;quot; &amp;quot;多&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>208</td><td class='line-content'>    (&amp;quot;ち&amp;quot; (&amp;quot;地&amp;quot; &amp;quot;値&amp;quot; &amp;quot;知&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>209</td><td class='line-content'>    (&amp;quot;つ&amp;quot; (&amp;quot;津&amp;quot; &amp;quot;通&amp;quot; &amp;quot;都&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>210</td><td class='line-content'>    (&amp;quot;て&amp;quot; (&amp;quot;手&amp;quot; &amp;quot;天&amp;quot; &amp;quot;転&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>211</td><td class='line-content'>    (&amp;quot;と&amp;quot; (&amp;quot;戸&amp;quot; &amp;quot;都&amp;quot; &amp;quot;土&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>212</td><td class='line-content'>    (&amp;quot;な&amp;quot; (&amp;quot;名&amp;quot; &amp;quot;那&amp;quot; &amp;quot;奈&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>213</td><td class='line-content'>    (&amp;quot;に&amp;quot; (&amp;quot;二&amp;quot; &amp;quot;荷&amp;quot; &amp;quot;似&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>214</td><td class='line-content'>    (&amp;quot;ぬ&amp;quot; (&amp;quot;奴&amp;quot; &amp;quot;怒&amp;quot; &amp;quot;努&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>215</td><td class='line-content'>    (&amp;quot;ね&amp;quot; (&amp;quot;根&amp;quot; &amp;quot;値&amp;quot; &amp;quot;寝&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>216</td><td class='line-content'>    (&amp;quot;の&amp;quot; (&amp;quot;之&amp;quot; &amp;quot;乃&amp;quot; &amp;quot;野&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>217</td><td class='line-content'>    (&amp;quot;は&amp;quot; (&amp;quot;歯&amp;quot; &amp;quot;派&amp;quot; &amp;quot;波&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>218</td><td class='line-content'>    (&amp;quot;ひ&amp;quot; (&amp;quot;日&amp;quot; &amp;quot;火&amp;quot; &amp;quot;費&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>219</td><td class='line-content'>    (&amp;quot;ふ&amp;quot; (&amp;quot;府&amp;quot; &amp;quot;不&amp;quot; &amp;quot;符&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>220</td><td class='line-content'>    (&amp;quot;へ&amp;quot; (&amp;quot;辺&amp;quot; &amp;quot;戸&amp;quot; &amp;quot;平&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>221</td><td class='line-content'>    (&amp;quot;ほ&amp;quot; (&amp;quot;帆&amp;quot; &amp;quot;保&amp;quot; &amp;quot;歩&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>222</td><td class='line-content'>    (&amp;quot;ま&amp;quot; (&amp;quot;真&amp;quot; &amp;quot;間&amp;quot; &amp;quot;摩&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>223</td><td class='line-content'>    (&amp;quot;み&amp;quot; (&amp;quot;見&amp;quot; &amp;quot;美&amp;quot; &amp;quot;三&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>224</td><td class='line-content'>    (&amp;quot;む&amp;quot; (&amp;quot;無&amp;quot; &amp;quot;務&amp;quot; &amp;quot;夢&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>225</td><td class='line-content'>    (&amp;quot;め&amp;quot; (&amp;quot;目&amp;quot; &amp;quot;芽&amp;quot; &amp;quot;女&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>226</td><td class='line-content'>    (&amp;quot;も&amp;quot; (&amp;quot;毛&amp;quot; &amp;quot;藻&amp;quot; &amp;quot;喪&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>227</td><td class='line-content'>    (&amp;quot;や&amp;quot; (&amp;quot;屋&amp;quot; &amp;quot;也&amp;quot; &amp;quot;夜&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>228</td><td class='line-content'>    (&amp;quot;ゆ&amp;quot; (&amp;quot;由&amp;quot; &amp;quot;遊&amp;quot; &amp;quot;湯&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>229</td><td class='line-content'>    (&amp;quot;よ&amp;quot; (&amp;quot;与&amp;quot; &amp;quot;余&amp;quot; &amp;quot;世&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>230</td><td class='line-content'>    (&amp;quot;ら&amp;quot; (&amp;quot;良&amp;quot; &amp;quot;羅&amp;quot; &amp;quot;等&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>231</td><td class='line-content'>    (&amp;quot;り&amp;quot; (&amp;quot;利&amp;quot; &amp;quot;理&amp;quot; &amp;quot;里&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>232</td><td class='line-content'>    (&amp;quot;る&amp;quot; (&amp;quot;留&amp;quot; &amp;quot;流&amp;quot; &amp;quot;類&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>233</td><td class='line-content'>    (&amp;quot;れ&amp;quot; (&amp;quot;例&amp;quot; &amp;quot;礼&amp;quot; &amp;quot;麗&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>234</td><td class='line-content'>    (&amp;quot;ろ&amp;quot; (&amp;quot;路&amp;quot; &amp;quot;炉&amp;quot; &amp;quot;露&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>235</td><td class='line-content'>    (&amp;quot;わ&amp;quot; (&amp;quot;和&amp;quot; &amp;quot;話&amp;quot; &amp;quot;輪&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>236</td><td class='line-content'>    (&amp;quot;を&amp;quot; (&amp;quot;於&amp;quot; &amp;quot;遠&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>237</td><td class='line-content'>    (&amp;quot;ん&amp;quot; (&amp;quot;无&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>238</td><td class='line-content'>    ;; 基本的な単語</td></tr>
<tr class=''><td class='line-number'>239</td><td class='line-content'>    (&amp;quot;かんじ&amp;quot; (&amp;quot;漢字&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>240</td><td class='line-content'>    (&amp;quot;にほん&amp;quot; (&amp;quot;日本&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>241</td><td class='line-content'>    (&amp;quot;ひらがな&amp;quot; (&amp;quot;平仮名&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>242</td><td class='line-content'>    (&amp;quot;かたかな&amp;quot; (&amp;quot;片仮名&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>243</td><td class='line-content'>    (&amp;quot;じしょ&amp;quot; (&amp;quot;辞書&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>244</td><td class='line-content'>    (&amp;quot;へんかん&amp;quot; (&amp;quot;変換&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>245</td><td class='line-content'>    (&amp;quot;にゅうりょく&amp;quot; (&amp;quot;入力&amp;quot;)))</td></tr>
<tr class=''><td class='line-number'>246</td><td class='line-content'>  &amp;quot;組み込みの最小限辞書データ。</td></tr>
<tr class=''><td class='line-number'>247</td><td class='line-content'>フォーマット: ((見出し語 (候補1 候補2 ...)) ...)&amp;quot;)</td></tr>
<tr class=''><td class='line-number'>248</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>249</td><td class='line-content'>(defvar nskk-dict-errors--fallback-active nil</td></tr>
<tr class=''><td class='line-number'>250</td><td class='line-content'>  &amp;quot;フォールバックモードが有効かどうか。&amp;quot;)</td></tr>
<tr class=''><td class='line-number'>251</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>252</td><td class='line-content'>;;; ログ管理</td></tr>
<tr class=''><td class='line-number'>253</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>254</td><td class='line-content'>(defvar nskk-dict-errors--log-buffer &amp;quot;*NSKK Error Log*&amp;quot;</td></tr>
<tr class=''><td class='line-number'>255</td><td class='line-content'>  &amp;quot;エラーログバッファ名。&amp;quot;)</td></tr>
<tr class=''><td class='line-number'>256</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>257</td><td class='line-content'>(defvar nskk-dict-errors--log-entries nil</td></tr>
<tr class=''><td class='line-number'>258</td><td class='line-content'>  &amp;quot;エラーログエントリのリスト。&amp;quot;)</td></tr>
<tr class=''><td class='line-number'>259</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>260</td><td class='line-content'>(defun nskk-dict-errors-log (severity type message &amp;optional data)</td></tr>
<tr class=''><td class='line-number'>261</td><td class='line-content'>  &amp;quot;エラーをログに記録する。</td></tr>
<tr class=''><td class='line-number'>262</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>263</td><td class='line-content'>引数:</td></tr>
<tr class=''><td class='line-number'>264</td><td class='line-content'>  SEVERITY - 'debug/'info/'warning/'error/'fatal</td></tr>
<tr class=''><td class='line-number'>265</td><td class='line-content'>  TYPE     - エラー型シンボル</td></tr>
<tr class=''><td class='line-number'>266</td><td class='line-content'>  MESSAGE  - エラーメッセージ</td></tr>
<tr class=''><td class='line-number'>267</td><td class='line-content'>  DATA     - 追加データ（オプション）&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>268</td><td class='line-content'>  (when nskk-dict-errors-enable-logging</td></tr>
<tr class='covered'><td class='line-number'>269</td><td class='line-content'>    (let* ((timestamp (float-time))</td></tr>
<tr class='covered'><td class='line-number'>270</td><td class='line-content'>           (entry (list :timestamp timestamp</td></tr>
<tr class='covered'><td class='line-number'>271</td><td class='line-content'>                       :severity severity</td></tr>
<tr class='covered'><td class='line-number'>272</td><td class='line-content'>                       :type type</td></tr>
<tr class='covered'><td class='line-number'>273</td><td class='line-content'>                       :message message</td></tr>
<tr class='covered'><td class='line-number'>274</td><td class='line-content'>                       :data data)))</td></tr>
<tr class=''><td class='line-number'>275</td><td class='line-content'>      ;; メモリに保存</td></tr>
<tr class='covered'><td class='line-number'>276</td><td class='line-content'>      (push entry nskk-dict-errors--log-entries)</td></tr>
<tr class=''><td class='line-number'>277</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>278</td><td class='line-content'>      ;; ファイルに追記</td></tr>
<tr class='covered'><td class='line-number'>279</td><td class='line-content'>      (when nskk-dict-errors-log-file</td></tr>
<tr class='covered'><td class='line-number'>280</td><td class='line-content'>        (condition-case err</td></tr>
<tr class='covered'><td class='line-number'>281</td><td class='line-content'>            (let ((log-file (expand-file-name nskk-dict-errors-log-file))</td></tr>
<tr class='covered'><td class='line-number'>282</td><td class='line-content'>                  (log-dir (file-name-directory</td></tr>
<tr class='covered'><td class='line-number'>283</td><td class='line-content'>                           (expand-file-name nskk-dict-errors-log-file))))</td></tr>
<tr class=''><td class='line-number'>284</td><td class='line-content'>              ;; ログディレクトリ作成</td></tr>
<tr class='covered'><td class='line-number'>285</td><td class='line-content'>              (unless (file-directory-p log-dir)</td></tr>
<tr class='covered'><td class='line-number'>286</td><td class='line-content'>                (make-directory log-dir t))</td></tr>
<tr class=''><td class='line-number'>287</td><td class='line-content'>              ;; ログ追記</td></tr>
<tr class='covered'><td class='line-number'>288</td><td class='line-content'>              (with-temp-buffer</td></tr>
<tr class='covered'><td class='line-number'>289</td><td class='line-content'>                (insert (format &amp;quot;[%s] [%s] %s: %s&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>290</td><td class='line-content'>                              (format-time-string &amp;quot;%Y-%m-%d %H:%M:%S&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>291</td><td class='line-content'>                                                 (seconds-to-time timestamp))</td></tr>
<tr class='covered'><td class='line-number'>292</td><td class='line-content'>                              (upcase (symbol-name severity))</td></tr>
<tr class='covered'><td class='line-number'>293</td><td class='line-content'>                              type</td></tr>
<tr class='covered'><td class='line-number'>294</td><td class='line-content'>                              message))</td></tr>
<tr class='covered'><td class='line-number'>295</td><td class='line-content'>                (when data</td></tr>
<tr class='covered'><td class='line-number'>296</td><td class='line-content'>                  (insert (format &amp;quot; - Data: %S&amp;quot; data)))</td></tr>
<tr class='covered'><td class='line-number'>297</td><td class='line-content'>                (insert &amp;quot;\n&amp;quot;)</td></tr>
<tr class='covered'><td class='line-number'>298</td><td class='line-content'>                (append-to-file (point-min) (point-max) log-file)))</td></tr>
<tr class=''><td class='line-number'>299</td><td class='line-content'>          (error</td></tr>
<tr class=''><td class='line-number'>300</td><td class='line-content'>           ;; ログ書き込みエラーは無視（無限ループ防止）</td></tr>
<tr class='covered'><td class='line-number'>301</td><td class='line-content'>           (message &amp;quot;Failed to write error log: %s&amp;quot; (error-message-string err))))))))</td></tr>
<tr class=''><td class='line-number'>302</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>303</td><td class='line-content'>;;;###autoload</td></tr>
<tr class=''><td class='line-number'>304</td><td class='line-content'>(defun nskk-dict-errors-show-log ()</td></tr>
<tr class=''><td class='line-number'>305</td><td class='line-content'>  &amp;quot;エラーログを表示する。&amp;quot;</td></tr>
<tr class=''><td class='line-number'>306</td><td class='line-content'>  (interactive)</td></tr>
<tr class='covered'><td class='line-number'>307</td><td class='line-content'>  (let ((buffer (get-buffer-create nskk-dict-errors--log-buffer)))</td></tr>
<tr class='covered'><td class='line-number'>308</td><td class='line-content'>    (with-current-buffer buffer</td></tr>
<tr class='covered'><td class='line-number'>309</td><td class='line-content'>      (erase-buffer)</td></tr>
<tr class='onevalue'><td class='line-number'>310</td><td class='line-content'>      (insert &amp;quot;NSKK Error Log\n&amp;quot;)</td></tr>
<tr class='onevalue'><td class='line-number'>311</td><td class='line-content'>      (insert &amp;quot;==============\n\n&amp;quot;)</td></tr>
<tr class='covered'><td class='line-number'>312</td><td class='line-content'>      (if (null nskk-dict-errors--log-entries)</td></tr>
<tr class='onevalue'><td class='line-number'>313</td><td class='line-content'>          (insert &amp;quot;No errors logged.\n&amp;quot;)</td></tr>
<tr class='covered'><td class='line-number'>314</td><td class='line-content'>        (dolist (entry (reverse nskk-dict-errors--log-entries))</td></tr>
<tr class='covered'><td class='line-number'>315</td><td class='line-content'>          (insert (format &amp;quot;[%s] [%s] %s: %s\n&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>316</td><td class='line-content'>                        (format-time-string &amp;quot;%Y-%m-%d %H:%M:%S&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>317</td><td class='line-content'>                                          (seconds-to-time (plist-get entry :timestamp)))</td></tr>
<tr class='covered'><td class='line-number'>318</td><td class='line-content'>                        (upcase (symbol-name (plist-get entry :severity)))</td></tr>
<tr class='covered'><td class='line-number'>319</td><td class='line-content'>                        (plist-get entry :type)</td></tr>
<tr class='onevalue'><td class='line-number'>320</td><td class='line-content'>                        (plist-get entry :message)))</td></tr>
<tr class='covered'><td class='line-number'>321</td><td class='line-content'>          (when (plist-get entry :data)</td></tr>
<tr class='onevalue'><td class='line-number'>322</td><td class='line-content'>            (insert (format &amp;quot;  Data: %S\n&amp;quot; (plist-get entry :data))))</td></tr>
<tr class='onevalue'><td class='line-number'>323</td><td class='line-content'>          (insert &amp;quot;\n&amp;quot;)))</td></tr>
<tr class='covered'><td class='line-number'>324</td><td class='line-content'>      (goto-char (point-min))</td></tr>
<tr class='covered'><td class='line-number'>325</td><td class='line-content'>      (special-mode))</td></tr>
<tr class='covered'><td class='line-number'>326</td><td class='line-content'>    (display-buffer buffer)))</td></tr>
<tr class=''><td class='line-number'>327</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>328</td><td class='line-content'>;;;###autoload</td></tr>
<tr class=''><td class='line-number'>329</td><td class='line-content'>(defun nskk-dict-errors-clear-log ()</td></tr>
<tr class=''><td class='line-number'>330</td><td class='line-content'>  &amp;quot;エラーログをクリアする。&amp;quot;</td></tr>
<tr class=''><td class='line-number'>331</td><td class='line-content'>  (interactive)</td></tr>
<tr class='onevalue'><td class='line-number'>332</td><td class='line-content'>  (setq nskk-dict-errors--log-entries nil)</td></tr>
<tr class='covered'><td class='line-number'>333</td><td class='line-content'>  (when (get-buffer nskk-dict-errors--log-buffer)</td></tr>
<tr class='covered'><td class='line-number'>334</td><td class='line-content'>    (kill-buffer nskk-dict-errors--log-buffer))</td></tr>
<tr class='covered'><td class='line-number'>335</td><td class='line-content'>  (when (and nskk-dict-errors-log-file</td></tr>
<tr class='covered'><td class='line-number'>336</td><td class='line-content'>            (file-exists-p nskk-dict-errors-log-file))</td></tr>
<tr class='covered'><td class='line-number'>337</td><td class='line-content'>    (delete-file nskk-dict-errors-log-file))</td></tr>
<tr class='onevalue'><td class='line-number'>338</td><td class='line-content'>  (message &amp;quot;Error log cleared&amp;quot;))</td></tr>
<tr class=''><td class='line-number'>339</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>340</td><td class='line-content'>;;; エラーヘルパー関数</td></tr>
<tr class=''><td class='line-number'>341</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>342</td><td class='line-content'>(defun nskk-dict-errors-create (type message &amp;optional data)</td></tr>
<tr class=''><td class='line-number'>343</td><td class='line-content'>  &amp;quot;エラー情報オブジェクトを作成する。</td></tr>
<tr class=''><td class='line-number'>344</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>345</td><td class='line-content'>引数:</td></tr>
<tr class=''><td class='line-number'>346</td><td class='line-content'>  TYPE    - エラー型シンボル</td></tr>
<tr class=''><td class='line-number'>347</td><td class='line-content'>  MESSAGE - エラーメッセージ</td></tr>
<tr class=''><td class='line-number'>348</td><td class='line-content'>  DATA    - エラーデータ（オプション）</td></tr>
<tr class=''><td class='line-number'>349</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>350</td><td class='line-content'>戻り値:</td></tr>
<tr class=''><td class='line-number'>351</td><td class='line-content'>  nskk-dict-error-info構造体&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>352</td><td class='line-content'>  (nskk-dict-error-info--create</td></tr>
<tr class='covered'><td class='line-number'>353</td><td class='line-content'>   :type type</td></tr>
<tr class='covered'><td class='line-number'>354</td><td class='line-content'>   :message message</td></tr>
<tr class='covered'><td class='line-number'>355</td><td class='line-content'>   :data data</td></tr>
<tr class='covered'><td class='line-number'>356</td><td class='line-content'>   :timestamp (float-time)))</td></tr>
<tr class=''><td class='line-number'>357</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>358</td><td class='line-content'>(defun nskk-dict-errors-format-user-message (error-info)</td></tr>
<tr class=''><td class='line-number'>359</td><td class='line-content'>  &amp;quot;ユーザー向けのエラーメッセージをフォーマットする。</td></tr>
<tr class=''><td class='line-number'>360</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>361</td><td class='line-content'>引数:</td></tr>
<tr class=''><td class='line-number'>362</td><td class='line-content'>  ERROR-INFO - エラー型シンボルまたはnskk-dict-error-info構造体</td></tr>
<tr class=''><td class='line-number'>363</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>364</td><td class='line-content'>戻り値:</td></tr>
<tr class=''><td class='line-number'>365</td><td class='line-content'>  フォーマットされたメッセージ文字列&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>366</td><td class='line-content'>  (let ((type (if (nskk-dict-error-info-p error-info)</td></tr>
<tr class='covered'><td class='line-number'>367</td><td class='line-content'>                 (nskk-dict-error-info-type error-info)</td></tr>
<tr class='covered'><td class='line-number'>368</td><td class='line-content'>               error-info))</td></tr>
<tr class='covered'><td class='line-number'>369</td><td class='line-content'>        (data (when (nskk-dict-error-info-p error-info)</td></tr>
<tr class='covered'><td class='line-number'>370</td><td class='line-content'>               (nskk-dict-error-info-data error-info))))</td></tr>
<tr class='covered'><td class='line-number'>371</td><td class='line-content'>    (pcase type</td></tr>
<tr class=''><td class='line-number'>372</td><td class='line-content'>      ('nskk-dict-io-file-not-found</td></tr>
<tr class='covered'><td class='line-number'>373</td><td class='line-content'>       (format &amp;quot;辞書ファイルが見つかりません: %s\nフォールバック辞書を使用します。\n設定を確認してください: M-x customize-group RET nskk-dict-errors RET&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>374</td><td class='line-content'>              (or (car data) &amp;quot;不明&amp;quot;)))</td></tr>
<tr class=''><td class='line-number'>375</td><td class='line-content'>      ('nskk-dict-io-permission-denied</td></tr>
<tr class='covered'><td class='line-number'>376</td><td class='line-content'>       (format &amp;quot;辞書ファイルへのアクセス権限がありません: %s\n読み取り専用モードで動作します。&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>377</td><td class='line-content'>              (or (car data) &amp;quot;不明&amp;quot;)))</td></tr>
<tr class=''><td class='line-number'>378</td><td class='line-content'>      ('nskk-dict-io-checksum-mismatch</td></tr>
<tr class='covered'><td class='line-number'>379</td><td class='line-content'>       (format &amp;quot;辞書ファイルのチェックサムが一致しません: %s\nファイルが破損している可能性があります。\nバックアップから復旧を試みます。&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>380</td><td class='line-content'>              (or (car data) &amp;quot;不明&amp;quot;)))</td></tr>
<tr class=''><td class='line-number'>381</td><td class='line-content'>      ('nskk-dict-io-backup-failed</td></tr>
<tr class=''><td class='line-number'>382</td><td class='line-content'>       &amp;quot;辞書のバックアップに失敗しました。\nディスク容量を確認してください。&amp;quot;)</td></tr>
<tr class=''><td class='line-number'>383</td><td class='line-content'>      ('nskk-dict-parse-invalid-format</td></tr>
<tr class='covered'><td class='line-number'>384</td><td class='line-content'>       (format &amp;quot;辞書フォーマットが不正です: %s\nバックアップから復旧を試みます。&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>385</td><td class='line-content'>              (or (car data) &amp;quot;不明&amp;quot;)))</td></tr>
<tr class=''><td class='line-number'>386</td><td class='line-content'>      ('nskk-dict-parse-encoding-error</td></tr>
<tr class='covered'><td class='line-number'>387</td><td class='line-content'>       (format &amp;quot;エンコーディングエラーが発生しました: %s\n別のエンコーディングで再試行します。&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>388</td><td class='line-content'>              (or (car data) &amp;quot;不明&amp;quot;)))</td></tr>
<tr class=''><td class='line-number'>389</td><td class='line-content'>      ('nskk-dict-struct-invalid-entry</td></tr>
<tr class='covered'><td class='line-number'>390</td><td class='line-content'>       (format &amp;quot;不正な辞書エントリが見つかりました: %s\nエントリをスキップして続行します。&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>391</td><td class='line-content'>              (or (car data) &amp;quot;不明&amp;quot;)))</td></tr>
<tr class=''><td class='line-number'>392</td><td class='line-content'>      (_</td></tr>
<tr class='covered'><td class='line-number'>393</td><td class='line-content'>       (format &amp;quot;辞書エラーが発生しました: %s&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>394</td><td class='line-content'>              (if (nskk-dict-error-info-p error-info)</td></tr>
<tr class='covered'><td class='line-number'>395</td><td class='line-content'>                  (nskk-dict-error-info-message error-info)</td></tr>
<tr class='covered'><td class='line-number'>396</td><td class='line-content'>                (symbol-name type)))))))</td></tr>
<tr class=''><td class='line-number'>397</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>398</td><td class='line-content'>(defun nskk-dict-errors-notify (error-info)</td></tr>
<tr class=''><td class='line-number'>399</td><td class='line-content'>  &amp;quot;ユーザーにエラーを通知する。</td></tr>
<tr class=''><td class='line-number'>400</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>401</td><td class='line-content'>引数:</td></tr>
<tr class=''><td class='line-number'>402</td><td class='line-content'>  ERROR-INFO - エラー型シンボルまたはnskk-dict-error-info構造体&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>403</td><td class='line-content'>  (let ((message-text (nskk-dict-errors-format-user-message error-info)))</td></tr>
<tr class='covered'><td class='line-number'>404</td><td class='line-content'>    (pcase nskk-dict-errors-notification-method</td></tr>
<tr class=''><td class='line-number'>405</td><td class='line-content'>      ('message</td></tr>
<tr class='covered'><td class='line-number'>406</td><td class='line-content'>       (message &amp;quot;%s&amp;quot; message-text))</td></tr>
<tr class=''><td class='line-number'>407</td><td class='line-content'>      ('popup</td></tr>
<tr class=''><td class='line-number'>408</td><td class='line-content'>       ;; 将来実装: ポップアップ表示</td></tr>
<tr class='covered'><td class='line-number'>409</td><td class='line-content'>       (message &amp;quot;%s&amp;quot; message-text))</td></tr>
<tr class=''><td class='line-number'>410</td><td class='line-content'>      ('silent</td></tr>
<tr class='covered'><td class='line-number'>411</td><td class='line-content'>       nil))))</td></tr>
<tr class=''><td class='line-number'>412</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>413</td><td class='line-content'>;;; フォールバック辞書機能</td></tr>
<tr class=''><td class='line-number'>414</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>415</td><td class='line-content'>(defun nskk-dict-errors-create-fallback-index ()</td></tr>
<tr class=''><td class='line-number'>416</td><td class='line-content'>  &amp;quot;フォールバック辞書のインデックスを作成する。</td></tr>
<tr class=''><td class='line-number'>417</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>418</td><td class='line-content'>優先順位:</td></tr>
<tr class=''><td class='line-number'>419</td><td class='line-content'>1. nskk-dict-errors-fallback-dict-path が設定されていればそれを使用</td></tr>
<tr class=''><td class='line-number'>420</td><td class='line-content'>2. 組み込み辞書を使用</td></tr>
<tr class=''><td class='line-number'>421</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>422</td><td class='line-content'>戻り値:</td></tr>
<tr class=''><td class='line-number'>423</td><td class='line-content'>  nskk-dict-index構造体（nskk-dict-struct.el）&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>424</td><td class='line-content'>  (require 'nskk-dict-struct)</td></tr>
<tr class=''><td class='line-number'>425</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>426</td><td class='line-content'>  (nskk-dict-errors-log 'info 'fallback-dict</td></tr>
<tr class='covered'><td class='line-number'>427</td><td class='line-content'>                       &amp;quot;Creating fallback dictionary index&amp;quot;)</td></tr>
<tr class='covered'><td class='line-number'>428</td><td class='line-content'>  (setq nskk-dict-errors--fallback-active t)</td></tr>
<tr class=''><td class='line-number'>429</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>430</td><td class='line-content'>  (if (and nskk-dict-errors-fallback-dict-path</td></tr>
<tr class='covered'><td class='line-number'>431</td><td class='line-content'>          (file-exists-p nskk-dict-errors-fallback-dict-path))</td></tr>
<tr class=''><td class='line-number'>432</td><td class='line-content'>      ;; カスタムフォールバック辞書を使用</td></tr>
<tr class='covered'><td class='line-number'>433</td><td class='line-content'>      (condition-case err</td></tr>
<tr class='covered'><td class='line-number'>434</td><td class='line-content'>          (progn</td></tr>
<tr class='covered'><td class='line-number'>435</td><td class='line-content'>            (require 'nskk-dict-io)</td></tr>
<tr class='covered'><td class='line-number'>436</td><td class='line-content'>            (nskk-dict-errors-log 'info 'fallback-dict</td></tr>
<tr class='covered'><td class='line-number'>437</td><td class='line-content'>                                 (format &amp;quot;Loading custom fallback: %s&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>438</td><td class='line-content'>                                        nskk-dict-errors-fallback-dict-path))</td></tr>
<tr class='covered'><td class='line-number'>439</td><td class='line-content'>            (nskk-load-dictionary nskk-dict-errors-fallback-dict-path))</td></tr>
<tr class=''><td class='line-number'>440</td><td class='line-content'>        (error</td></tr>
<tr class='covered'><td class='line-number'>441</td><td class='line-content'>         (nskk-dict-errors-log 'warning 'fallback-dict</td></tr>
<tr class='covered'><td class='line-number'>442</td><td class='line-content'>                              (format &amp;quot;Failed to load custom fallback, using built-in: %s&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>443</td><td class='line-content'>                                     (error-message-string err)))</td></tr>
<tr class='covered'><td class='line-number'>444</td><td class='line-content'>         (nskk-dict-errors--create-builtin-index)))</td></tr>
<tr class=''><td class='line-number'>445</td><td class='line-content'>    ;; 組み込み辞書を使用</td></tr>
<tr class='covered'><td class='line-number'>446</td><td class='line-content'>    (nskk-dict-errors--create-builtin-index)))</td></tr>
<tr class=''><td class='line-number'>447</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>448</td><td class='line-content'>(defun nskk-dict-errors--create-builtin-index ()</td></tr>
<tr class=''><td class='line-number'>449</td><td class='line-content'>  &amp;quot;組み込み辞書からインデックスを作成する。</td></tr>
<tr class=''><td class='line-number'>450</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>451</td><td class='line-content'>戻り値:</td></tr>
<tr class=''><td class='line-number'>452</td><td class='line-content'>  nskk-dict-index構造体&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>453</td><td class='line-content'>  (require 'nskk-dict-struct)</td></tr>
<tr class=''><td class='line-number'>454</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>455</td><td class='line-content'>  (let ((index (nskk-dict-index--create</td></tr>
<tr class='covered'><td class='line-number'>456</td><td class='line-content'>               :okuri-ari-table (make-hash-table :test 'equal)</td></tr>
<tr class='covered'><td class='line-number'>457</td><td class='line-content'>               :okuri-nasi-table (make-hash-table :test 'equal))))</td></tr>
<tr class='covered'><td class='line-number'>458</td><td class='line-content'>    (dolist (entry-data nskk-dict-errors--builtin-dict)</td></tr>
<tr class='covered'><td class='line-number'>459</td><td class='line-content'>      (let* ((midashi (car entry-data))</td></tr>
<tr class='covered'><td class='line-number'>460</td><td class='line-content'>             (words (cadr entry-data))</td></tr>
<tr class=''><td class='line-number'>461</td><td class='line-content'>             ;; 候補リストを作成</td></tr>
<tr class='covered'><td class='line-number'>462</td><td class='line-content'>             (candidates (mapcar (lambda (word)</td></tr>
<tr class='covered'><td class='line-number'>463</td><td class='line-content'>                                  (nskk-dict-candidate--create</td></tr>
<tr class='covered'><td class='line-number'>464</td><td class='line-content'>                                   :word word</td></tr>
<tr class=''><td class='line-number'>465</td><td class='line-content'>                                   :annotation nil</td></tr>
<tr class='covered'><td class='line-number'>466</td><td class='line-content'>                                   :score 0))</td></tr>
<tr class='covered'><td class='line-number'>467</td><td class='line-content'>                                words))</td></tr>
<tr class=''><td class='line-number'>468</td><td class='line-content'>             ;; エントリを作成（全スロットを明示的に指定）</td></tr>
<tr class='covered'><td class='line-number'>469</td><td class='line-content'>             (entry (nskk-dict-entry--create</td></tr>
<tr class='covered'><td class='line-number'>470</td><td class='line-content'>                    :midashi midashi</td></tr>
<tr class='covered'><td class='line-number'>471</td><td class='line-content'>                    :candidates candidates)))</td></tr>
<tr class=''><td class='line-number'>472</td><td class='line-content'>        ;; インデックスに追加</td></tr>
<tr class='covered'><td class='line-number'>473</td><td class='line-content'>        (puthash midashi entry</td></tr>
<tr class='covered'><td class='line-number'>474</td><td class='line-content'>                (nskk-dict-index-okuri-nasi-table index))))</td></tr>
<tr class=''><td class='line-number'>475</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>476</td><td class='line-content'>    (nskk-dict-errors-log 'info 'fallback-dict</td></tr>
<tr class='covered'><td class='line-number'>477</td><td class='line-content'>                         (format &amp;quot;Built-in dictionary loaded: %d entries&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>478</td><td class='line-content'>                                (hash-table-count</td></tr>
<tr class='covered'><td class='line-number'>479</td><td class='line-content'>                                 (nskk-dict-index-okuri-nasi-table index))))</td></tr>
<tr class='covered'><td class='line-number'>480</td><td class='line-content'>    index))</td></tr>
<tr class=''><td class='line-number'>481</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>482</td><td class='line-content'>(defun nskk-dict-errors-is-fallback-active-p ()</td></tr>
<tr class=''><td class='line-number'>483</td><td class='line-content'>  &amp;quot;現在フォールバックモードか判定する。</td></tr>
<tr class=''><td class='line-number'>484</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>485</td><td class='line-content'>戻り値:</td></tr>
<tr class=''><td class='line-number'>486</td><td class='line-content'>  フォールバックモードの場合t、それ以外nil&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>487</td><td class='line-content'>  nskk-dict-errors--fallback-active)</td></tr>
<tr class=''><td class='line-number'>488</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>489</td><td class='line-content'>;;; リカバリー機構</td></tr>
<tr class=''><td class='line-number'>490</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>491</td><td class='line-content'>(defun nskk-dict-errors--recover-from-backup (file-path)</td></tr>
<tr class=''><td class='line-number'>492</td><td class='line-content'>  &amp;quot;バックアップから辞書を復旧する。</td></tr>
<tr class=''><td class='line-number'>493</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>494</td><td class='line-content'>引数:</td></tr>
<tr class=''><td class='line-number'>495</td><td class='line-content'>  FILE-PATH - 復旧対象のファイルパス</td></tr>
<tr class=''><td class='line-number'>496</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>497</td><td class='line-content'>戻り値:</td></tr>
<tr class=''><td class='line-number'>498</td><td class='line-content'>  (success . result) または (failure . error-info)&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>499</td><td class='line-content'>  (require 'nskk-dict-io)</td></tr>
<tr class=''><td class='line-number'>500</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>501</td><td class='line-content'>  (nskk-dict-errors-log 'info 'recovery</td></tr>
<tr class='covered'><td class='line-number'>502</td><td class='line-content'>                       (format &amp;quot;Attempting recovery from backup: %s&amp;quot; file-path))</td></tr>
<tr class=''><td class='line-number'>503</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>504</td><td class='line-content'>  (condition-case err</td></tr>
<tr class='covered'><td class='line-number'>505</td><td class='line-content'>      (let* ((backup-dir (expand-file-name nskk-dict-io-backup-dir))</td></tr>
<tr class='covered'><td class='line-number'>506</td><td class='line-content'>             (basename (file-name-nondirectory file-path))</td></tr>
<tr class='covered'><td class='line-number'>507</td><td class='line-content'>             (backup-files (when (file-directory-p backup-dir)</td></tr>
<tr class='covered'><td class='line-number'>508</td><td class='line-content'>                            (directory-files backup-dir t</td></tr>
<tr class='covered'><td class='line-number'>509</td><td class='line-content'>                                           (concat &amp;quot;^&amp;quot; (regexp-quote basename)</td></tr>
<tr class='covered'><td class='line-number'>510</td><td class='line-content'>                                                  &amp;quot;\\..*\\.bak$&amp;quot;)))))</td></tr>
<tr class='covered'><td class='line-number'>511</td><td class='line-content'>        (if (null backup-files)</td></tr>
<tr class='covered'><td class='line-number'>512</td><td class='line-content'>            (cons 'failure</td></tr>
<tr class='covered'><td class='line-number'>513</td><td class='line-content'>                 (nskk-dict-errors-create 'nskk-dict-io-backup-failed</td></tr>
<tr class=''><td class='line-number'>514</td><td class='line-content'>                                         &amp;quot;No backup files found&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>515</td><td class='line-content'>                                         (list file-path)))</td></tr>
<tr class=''><td class='line-number'>516</td><td class='line-content'>          ;; 最新のバックアップを使用</td></tr>
<tr class='covered'><td class='line-number'>517</td><td class='line-content'>          (let ((latest-backup (car (sort backup-files</td></tr>
<tr class=''><td class='line-number'>518</td><td class='line-content'>                                         (lambda (a b)</td></tr>
<tr class='covered'><td class='line-number'>519</td><td class='line-content'>                                           (time-less-p</td></tr>
<tr class='covered'><td class='line-number'>520</td><td class='line-content'>                                            (file-attribute-modification-time</td></tr>
<tr class='covered'><td class='line-number'>521</td><td class='line-content'>                                             (file-attributes b))</td></tr>
<tr class='covered'><td class='line-number'>522</td><td class='line-content'>                                            (file-attribute-modification-time</td></tr>
<tr class='covered'><td class='line-number'>523</td><td class='line-content'>                                             (file-attributes a))))))))</td></tr>
<tr class='covered'><td class='line-number'>524</td><td class='line-content'>            (nskk-dict-errors-log 'info 'recovery</td></tr>
<tr class='covered'><td class='line-number'>525</td><td class='line-content'>                                 (format &amp;quot;Restoring from: %s&amp;quot; latest-backup))</td></tr>
<tr class='covered'><td class='line-number'>526</td><td class='line-content'>            (copy-file latest-backup file-path t)</td></tr>
<tr class='covered'><td class='line-number'>527</td><td class='line-content'>            (cons 'success file-path))))</td></tr>
<tr class=''><td class='line-number'>528</td><td class='line-content'>    (error</td></tr>
<tr class='covered'><td class='line-number'>529</td><td class='line-content'>     (cons 'failure</td></tr>
<tr class='covered'><td class='line-number'>530</td><td class='line-content'>          (nskk-dict-errors-create 'nskk-dict-io-backup-failed</td></tr>
<tr class='covered'><td class='line-number'>531</td><td class='line-content'>                                  (error-message-string err)</td></tr>
<tr class='covered'><td class='line-number'>532</td><td class='line-content'>                                  (list file-path))))))</td></tr>
<tr class=''><td class='line-number'>533</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>534</td><td class='line-content'>(defun nskk-dict-errors--retry-with-encoding (file-path encoding)</td></tr>
<tr class=''><td class='line-number'>535</td><td class='line-content'>  &amp;quot;別のエンコーディングで辞書読み込みを再試行する。</td></tr>
<tr class=''><td class='line-number'>536</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>537</td><td class='line-content'>引数:</td></tr>
<tr class=''><td class='line-number'>538</td><td class='line-content'>  FILE-PATH - ファイルパス</td></tr>
<tr class=''><td class='line-number'>539</td><td class='line-content'>  ENCODING  - エンコーディング ('utf-8 または 'euc-jp)</td></tr>
<tr class=''><td class='line-number'>540</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>541</td><td class='line-content'>戻り値:</td></tr>
<tr class=''><td class='line-number'>542</td><td class='line-content'>  (success . index) または (failure . error-info)&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>543</td><td class='line-content'>  (require 'nskk-dict-parser)</td></tr>
<tr class=''><td class='line-number'>544</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>545</td><td class='line-content'>  (nskk-dict-errors-log 'info 'recovery</td></tr>
<tr class='covered'><td class='line-number'>546</td><td class='line-content'>                       (format &amp;quot;Retrying with encoding %s: %s&amp;quot; encoding file-path))</td></tr>
<tr class=''><td class='line-number'>547</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>548</td><td class='line-content'>  (condition-case err</td></tr>
<tr class='covered'><td class='line-number'>549</td><td class='line-content'>      (let* ((coding-system-for-read encoding)</td></tr>
<tr class='covered'><td class='line-number'>550</td><td class='line-content'>             (parsed (nskk-parse-dictionary file-path))</td></tr>
<tr class='covered'><td class='line-number'>551</td><td class='line-content'>             (index (nskk-dict-struct-from-parser parsed)))</td></tr>
<tr class='covered'><td class='line-number'>552</td><td class='line-content'>        (cons 'success index))</td></tr>
<tr class=''><td class='line-number'>553</td><td class='line-content'>    (error</td></tr>
<tr class='covered'><td class='line-number'>554</td><td class='line-content'>     (cons 'failure</td></tr>
<tr class='covered'><td class='line-number'>555</td><td class='line-content'>          (nskk-dict-errors-create 'nskk-dict-parse-encoding-error</td></tr>
<tr class='covered'><td class='line-number'>556</td><td class='line-content'>                                  (error-message-string err)</td></tr>
<tr class='covered'><td class='line-number'>557</td><td class='line-content'>                                  (list file-path encoding))))))</td></tr>
<tr class=''><td class='line-number'>558</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>559</td><td class='line-content'>(defun nskk-dict-errors-auto-recover (error dict-path)</td></tr>
<tr class=''><td class='line-number'>560</td><td class='line-content'>  &amp;quot;エラーから自動的にリカバリーを試みる。</td></tr>
<tr class=''><td class='line-number'>561</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>562</td><td class='line-content'>引数:</td></tr>
<tr class=''><td class='line-number'>563</td><td class='line-content'>  ERROR     - エラーシンボルまたはエラーリスト</td></tr>
<tr class=''><td class='line-number'>564</td><td class='line-content'>  DICT-PATH - 辞書ファイルパス</td></tr>
<tr class=''><td class='line-number'>565</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>566</td><td class='line-content'>戻り値:</td></tr>
<tr class=''><td class='line-number'>567</td><td class='line-content'>  (success . result) または (failure . error-info)</td></tr>
<tr class=''><td class='line-number'>568</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>569</td><td class='line-content'>リカバリー戦略:</td></tr>
<tr class=''><td class='line-number'>570</td><td class='line-content'>- ファイルなし          → フォールバック辞書を使用</td></tr>
<tr class=''><td class='line-number'>571</td><td class='line-content'>- パースエラー          → バックアップから復旧</td></tr>
<tr class=''><td class='line-number'>572</td><td class='line-content'>- チェックサム不一致    → バックアップから復旧</td></tr>
<tr class=''><td class='line-number'>573</td><td class='line-content'>- エンコーディングエラー → 別エンコーディングで再試行</td></tr>
<tr class=''><td class='line-number'>574</td><td class='line-content'>- その他                → フォールバック辞書を使用&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>575</td><td class='line-content'>  (let ((error-type (if (listp error) (car error) error)))</td></tr>
<tr class='covered'><td class='line-number'>576</td><td class='line-content'>    (nskk-dict-errors-log 'warning 'auto-recovery</td></tr>
<tr class='covered'><td class='line-number'>577</td><td class='line-content'>                         (format &amp;quot;Auto-recovery started for: %s (error: %s)&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>578</td><td class='line-content'>                                dict-path error-type))</td></tr>
<tr class=''><td class='line-number'>579</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>580</td><td class='line-content'>    (pcase error-type</td></tr>
<tr class=''><td class='line-number'>581</td><td class='line-content'>      ;; ファイルなし → フォールバック辞書</td></tr>
<tr class=''><td class='line-number'>582</td><td class='line-content'>      ('nskk-dict-io-file-not-found</td></tr>
<tr class='covered'><td class='line-number'>583</td><td class='line-content'>       (nskk-dict-errors-log 'info 'auto-recovery</td></tr>
<tr class='covered'><td class='line-number'>584</td><td class='line-content'>                            &amp;quot;Using fallback dictionary (file not found)&amp;quot;)</td></tr>
<tr class='covered'><td class='line-number'>585</td><td class='line-content'>       (cons 'success (nskk-dict-errors-create-fallback-index)))</td></tr>
<tr class=''><td class='line-number'>586</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>587</td><td class='line-content'>      ;; パースエラー → バックアップから復旧</td></tr>
<tr class=''><td class='line-number'>588</td><td class='line-content'>      ((or 'nskk-dict-parse-error 'nskk-dict-parse-invalid-format)</td></tr>
<tr class='covered'><td class='line-number'>589</td><td class='line-content'>       (let ((result (nskk-dict-errors--recover-from-backup dict-path)))</td></tr>
<tr class='covered'><td class='line-number'>590</td><td class='line-content'>         (if (eq (car result) 'success)</td></tr>
<tr class=''><td class='line-number'>591</td><td class='line-content'>             ;; バックアップから復旧成功 → 再読み込み</td></tr>
<tr class='covered'><td class='line-number'>592</td><td class='line-content'>             (condition-case err</td></tr>
<tr class='covered'><td class='line-number'>593</td><td class='line-content'>                 (progn</td></tr>
<tr class='covered'><td class='line-number'>594</td><td class='line-content'>                   (require 'nskk-dict-io)</td></tr>
<tr class='covered'><td class='line-number'>595</td><td class='line-content'>                   (cons 'success (nskk-load-dictionary dict-path)))</td></tr>
<tr class=''><td class='line-number'>596</td><td class='line-content'>               (error</td></tr>
<tr class=''><td class='line-number'>597</td><td class='line-content'>                ;; 再読み込みも失敗 → フォールバック</td></tr>
<tr class='covered'><td class='line-number'>598</td><td class='line-content'>                (nskk-dict-errors-log 'warning 'auto-recovery</td></tr>
<tr class=''><td class='line-number'>599</td><td class='line-content'>                                     &amp;quot;Backup recovery failed, using fallback&amp;quot;)</td></tr>
<tr class='covered'><td class='line-number'>600</td><td class='line-content'>                (cons 'success (nskk-dict-errors-create-fallback-index))))</td></tr>
<tr class=''><td class='line-number'>601</td><td class='line-content'>           ;; バックアップなし → フォールバック</td></tr>
<tr class='covered'><td class='line-number'>602</td><td class='line-content'>           (nskk-dict-errors-log 'warning 'auto-recovery</td></tr>
<tr class=''><td class='line-number'>603</td><td class='line-content'>                                &amp;quot;No backup available, using fallback&amp;quot;)</td></tr>
<tr class='covered'><td class='line-number'>604</td><td class='line-content'>           (cons 'success (nskk-dict-errors-create-fallback-index)))))</td></tr>
<tr class=''><td class='line-number'>605</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>606</td><td class='line-content'>      ;; チェックサム不一致 → バックアップから復旧</td></tr>
<tr class=''><td class='line-number'>607</td><td class='line-content'>      ('nskk-dict-io-checksum-mismatch</td></tr>
<tr class='covered'><td class='line-number'>608</td><td class='line-content'>       (let ((result (nskk-dict-errors--recover-from-backup dict-path)))</td></tr>
<tr class='covered'><td class='line-number'>609</td><td class='line-content'>         (if (eq (car result) 'success)</td></tr>
<tr class='covered'><td class='line-number'>610</td><td class='line-content'>             (condition-case err</td></tr>
<tr class='covered'><td class='line-number'>611</td><td class='line-content'>                 (progn</td></tr>
<tr class='covered'><td class='line-number'>612</td><td class='line-content'>                   (require 'nskk-dict-io)</td></tr>
<tr class='covered'><td class='line-number'>613</td><td class='line-content'>                   (cons 'success (nskk-load-dictionary dict-path t)))</td></tr>
<tr class=''><td class='line-number'>614</td><td class='line-content'>               (error</td></tr>
<tr class='covered'><td class='line-number'>615</td><td class='line-content'>                (nskk-dict-errors-log 'warning 'auto-recovery</td></tr>
<tr class=''><td class='line-number'>616</td><td class='line-content'>                                     &amp;quot;Recovery failed, using fallback&amp;quot;)</td></tr>
<tr class='covered'><td class='line-number'>617</td><td class='line-content'>                (cons 'success (nskk-dict-errors-create-fallback-index))))</td></tr>
<tr class='covered'><td class='line-number'>618</td><td class='line-content'>           (nskk-dict-errors-log 'warning 'auto-recovery</td></tr>
<tr class=''><td class='line-number'>619</td><td class='line-content'>                                &amp;quot;No backup available, using fallback&amp;quot;)</td></tr>
<tr class='covered'><td class='line-number'>620</td><td class='line-content'>           (cons 'success (nskk-dict-errors-create-fallback-index)))))</td></tr>
<tr class=''><td class='line-number'>621</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>622</td><td class='line-content'>      ;; エンコーディングエラー → 別エンコーディングで再試行</td></tr>
<tr class=''><td class='line-number'>623</td><td class='line-content'>      ('nskk-dict-parse-encoding-error</td></tr>
<tr class='covered'><td class='line-number'>624</td><td class='line-content'>       (let ((encodings '(utf-8 euc-jp)))</td></tr>
<tr class='covered'><td class='line-number'>625</td><td class='line-content'>         (cl-loop for encoding in encodings</td></tr>
<tr class='covered'><td class='line-number'>626</td><td class='line-content'>                 for result = (nskk-dict-errors--retry-with-encoding dict-path encoding)</td></tr>
<tr class='covered'><td class='line-number'>627</td><td class='line-content'>                 when (eq (car result) 'success)</td></tr>
<tr class='uncovered'><td class='line-number'>628</td><td class='line-content'>                 return result</td></tr>
<tr class='covered'><td class='line-number'>629</td><td class='line-content'>                 finally return (cons 'success (nskk-dict-errors-create-fallback-index)))))</td></tr>
<tr class=''><td class='line-number'>630</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>631</td><td class='line-content'>      ;; その他 → フォールバック辞書</td></tr>
<tr class=''><td class='line-number'>632</td><td class='line-content'>      (_</td></tr>
<tr class='covered'><td class='line-number'>633</td><td class='line-content'>       (nskk-dict-errors-log 'info 'auto-recovery</td></tr>
<tr class='covered'><td class='line-number'>634</td><td class='line-content'>                            (format &amp;quot;Using fallback dictionary (unknown error: %s)&amp;quot; error-type))</td></tr>
<tr class='covered'><td class='line-number'>635</td><td class='line-content'>       (cons 'success (nskk-dict-errors-create-fallback-index))))))</td></tr>
<tr class=''><td class='line-number'>636</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>637</td><td class='line-content'>;;; リカバリー付き辞書操作</td></tr>
<tr class=''><td class='line-number'>638</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>639</td><td class='line-content'>;;;###autoload</td></tr>
<tr class=''><td class='line-number'>640</td><td class='line-content'>(defun nskk-dict-errors-load-with-recovery (dict-path)</td></tr>
<tr class=''><td class='line-number'>641</td><td class='line-content'>  &amp;quot;エラーリカバリー付きで辞書を読み込む。</td></tr>
<tr class=''><td class='line-number'>642</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>643</td><td class='line-content'>引数:</td></tr>
<tr class=''><td class='line-number'>644</td><td class='line-content'>  DICT-PATH - 辞書ファイルパス</td></tr>
<tr class=''><td class='line-number'>645</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>646</td><td class='line-content'>戻り値:</td></tr>
<tr class=''><td class='line-number'>647</td><td class='line-content'>  nskk-dict-index構造体（失敗時はフォールバック辞書）&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>648</td><td class='line-content'>  (require 'nskk-dict-io)</td></tr>
<tr class=''><td class='line-number'>649</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>650</td><td class='line-content'>  (setq nskk-dict-errors--fallback-active nil)</td></tr>
<tr class=''><td class='line-number'>651</td><td class='line-content'></td></tr>
<tr class='covered'><td class='line-number'>652</td><td class='line-content'>  (condition-case err</td></tr>
<tr class='covered'><td class='line-number'>653</td><td class='line-content'>      (progn</td></tr>
<tr class='covered'><td class='line-number'>654</td><td class='line-content'>        (nskk-dict-errors-log 'info 'load &amp;quot;Loading dictionary&amp;quot; (list dict-path))</td></tr>
<tr class='covered'><td class='line-number'>655</td><td class='line-content'>        (nskk-load-dictionary dict-path))</td></tr>
<tr class=''><td class='line-number'>656</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>657</td><td class='line-content'>    ;; NSKKカスタムエラー</td></tr>
<tr class=''><td class='line-number'>658</td><td class='line-content'>    (nskk-dict-error</td></tr>
<tr class='covered'><td class='line-number'>659</td><td class='line-content'>     (nskk-dict-errors-log 'error (car err)</td></tr>
<tr class='covered'><td class='line-number'>660</td><td class='line-content'>                          (error-message-string err)</td></tr>
<tr class='covered'><td class='line-number'>661</td><td class='line-content'>                          (cdr err))</td></tr>
<tr class='covered'><td class='line-number'>662</td><td class='line-content'>     (nskk-dict-errors-notify (car err))</td></tr>
<tr class='covered'><td class='line-number'>663</td><td class='line-content'>     (if nskk-dict-errors-auto-recovery</td></tr>
<tr class='covered'><td class='line-number'>664</td><td class='line-content'>         (let ((recovery-result (nskk-dict-errors-auto-recover (car err) dict-path)))</td></tr>
<tr class='covered'><td class='line-number'>665</td><td class='line-content'>           (if (eq (car recovery-result) 'success)</td></tr>
<tr class='covered'><td class='line-number'>666</td><td class='line-content'>               (cdr recovery-result)</td></tr>
<tr class=''><td class='line-number'>667</td><td class='line-content'>             ;; リカバリー失敗 → フォールバック</td></tr>
<tr class='covered'><td class='line-number'>668</td><td class='line-content'>             (nskk-dict-errors-create-fallback-index)))</td></tr>
<tr class=''><td class='line-number'>669</td><td class='line-content'>       ;; 自動リカバリー無効 → エラーを再シグナル</td></tr>
<tr class='covered'><td class='line-number'>670</td><td class='line-content'>       (signal (car err) (cdr err))))</td></tr>
<tr class=''><td class='line-number'>671</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>672</td><td class='line-content'>    ;; 一般エラー</td></tr>
<tr class=''><td class='line-number'>673</td><td class='line-content'>    (error</td></tr>
<tr class='covered'><td class='line-number'>674</td><td class='line-content'>     (nskk-dict-errors-log 'error 'general-error</td></tr>
<tr class='covered'><td class='line-number'>675</td><td class='line-content'>                          (error-message-string err)</td></tr>
<tr class='uncovered'><td class='line-number'>676</td><td class='line-content'>                          err)</td></tr>
<tr class='covered'><td class='line-number'>677</td><td class='line-content'>     (if nskk-dict-errors-auto-recovery</td></tr>
<tr class='covered'><td class='line-number'>678</td><td class='line-content'>         (progn</td></tr>
<tr class='covered'><td class='line-number'>679</td><td class='line-content'>           (message &amp;quot;辞書読み込みエラー: %s\nフォールバック辞書を使用します。&amp;quot;</td></tr>
<tr class='covered'><td class='line-number'>680</td><td class='line-content'>                   (error-message-string err))</td></tr>
<tr class='covered'><td class='line-number'>681</td><td class='line-content'>           (nskk-dict-errors-create-fallback-index))</td></tr>
<tr class='covered'><td class='line-number'>682</td><td class='line-content'>       (signal (car err) (cdr err))))))</td></tr>
<tr class=''><td class='line-number'>683</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>684</td><td class='line-content'>(provide 'nskk-dict-errors)</td></tr>
<tr class=''><td class='line-number'>685</td><td class='line-content'></td></tr>
<tr class=''><td class='line-number'>686</td><td class='line-content'>;;; nskk-dict-errors.el ends here</td></tr>

    </table>
  </div>
  <div class='legend'>
    <div class='legend-item'><span class='legend-color' style='background: #e8f5e9;'></span>Covered</div>
    <div class='legend-item'><span class='legend-color' style='background: #ffebee;'></span>Uncovered</div>
    <div class='legend-item'><span class='legend-color' style='background: #fff3e0;'></span>1-Value</div>
    <div class='legend-item'><span class='legend-color' style='background: #f3e5f5;'></span>No-Return</div>
  </div>
</body>
</html>